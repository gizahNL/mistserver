var MD5=function(a){function b(a,b){var c,d,f,g,e;f=a&2147483648;g=b&2147483648;c=a&1073741824;d=b&1073741824;e=(a&1073741823)+(b&1073741823);return c&d?e^2147483648^f^g:c|d?e&1073741824?e^3221225472^f^g:e^1073741824^f^g:e^f^g}function c(a,c,d,f,g,e,h){a=b(a,b(b(c&d|~c&f,g),h));return b(a<<e|a>>>32-e,c)}function d(a,c,d,f,g,e,h){a=b(a,b(b(c&f|d&~f,g),h));return b(a<<e|a>>>32-e,c)}function e(a,c,d,f,g,e,h){a=b(a,b(b(c^d^f,g),h));return b(a<<e|a>>>32-e,c)}function n(a,c,d,f,g,e,h){a=b(a,b(b(d^(c|~f),
g),h));return b(a<<e|a>>>32-e,c)}function p(a){var b="",c="",d;for(d=0;3>=d;d++)c=a>>>8*d&255,c="0"+c.toString(16),b+=c.substr(c.length-2,2);return b}var h=[],u,w,k,A,l,g,f,m;a=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):(127<d&&2048>d?b+=String.fromCharCode(d>>6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128)),b+=String.fromCharCode(d&63|128))}return b}(a);h=function(a){var b,c=a.length;b=
c+8;for(var d=16*((b-b%64)/64+1),f=Array(d-1),g=0,e=0;e<c;)b=(e-e%4)/4,g=e%4*8,f[b]|=a.charCodeAt(e)<<g,e++;b=(e-e%4)/4;f[b]|=128<<e%4*8;f[d-2]=c<<3;f[d-1]=c>>>29;return f}(a);l=1732584193;g=4023233417;f=2562383102;m=271733878;for(a=0;a<h.length;a+=16)u=l,w=g,k=f,A=m,l=c(l,g,f,m,h[a+0],7,3614090360),m=c(m,l,g,f,h[a+1],12,3905402710),f=c(f,m,l,g,h[a+2],17,606105819),g=c(g,f,m,l,h[a+3],22,3250441966),l=c(l,g,f,m,h[a+4],7,4118548399),m=c(m,l,g,f,h[a+5],12,1200080426),f=c(f,m,l,g,h[a+6],17,2821735955),
g=c(g,f,m,l,h[a+7],22,4249261313),l=c(l,g,f,m,h[a+8],7,1770035416),m=c(m,l,g,f,h[a+9],12,2336552879),f=c(f,m,l,g,h[a+10],17,4294925233),g=c(g,f,m,l,h[a+11],22,2304563134),l=c(l,g,f,m,h[a+12],7,1804603682),m=c(m,l,g,f,h[a+13],12,4254626195),f=c(f,m,l,g,h[a+14],17,2792965006),g=c(g,f,m,l,h[a+15],22,1236535329),l=d(l,g,f,m,h[a+1],5,4129170786),m=d(m,l,g,f,h[a+6],9,3225465664),f=d(f,m,l,g,h[a+11],14,643717713),g=d(g,f,m,l,h[a+0],20,3921069994),l=d(l,g,f,m,h[a+5],5,3593408605),m=d(m,l,g,f,h[a+10],9,38016083),
f=d(f,m,l,g,h[a+15],14,3634488961),g=d(g,f,m,l,h[a+4],20,3889429448),l=d(l,g,f,m,h[a+9],5,568446438),m=d(m,l,g,f,h[a+14],9,3275163606),f=d(f,m,l,g,h[a+3],14,4107603335),g=d(g,f,m,l,h[a+8],20,1163531501),l=d(l,g,f,m,h[a+13],5,2850285829),m=d(m,l,g,f,h[a+2],9,4243563512),f=d(f,m,l,g,h[a+7],14,1735328473),g=d(g,f,m,l,h[a+12],20,2368359562),l=e(l,g,f,m,h[a+5],4,4294588738),m=e(m,l,g,f,h[a+8],11,2272392833),f=e(f,m,l,g,h[a+11],16,1839030562),g=e(g,f,m,l,h[a+14],23,4259657740),l=e(l,g,f,m,h[a+1],4,2763975236),
m=e(m,l,g,f,h[a+4],11,1272893353),f=e(f,m,l,g,h[a+7],16,4139469664),g=e(g,f,m,l,h[a+10],23,3200236656),l=e(l,g,f,m,h[a+13],4,681279174),m=e(m,l,g,f,h[a+0],11,3936430074),f=e(f,m,l,g,h[a+3],16,3572445317),g=e(g,f,m,l,h[a+6],23,76029189),l=e(l,g,f,m,h[a+9],4,3654602809),m=e(m,l,g,f,h[a+12],11,3873151461),f=e(f,m,l,g,h[a+15],16,530742520),g=e(g,f,m,l,h[a+2],23,3299628645),l=n(l,g,f,m,h[a+0],6,4096336452),m=n(m,l,g,f,h[a+7],10,1126891415),f=n(f,m,l,g,h[a+14],15,2878612391),g=n(g,f,m,l,h[a+5],21,4237533241),
l=n(l,g,f,m,h[a+12],6,1700485571),m=n(m,l,g,f,h[a+3],10,2399980690),f=n(f,m,l,g,h[a+10],15,4293915773),g=n(g,f,m,l,h[a+1],21,2240044497),l=n(l,g,f,m,h[a+8],6,1873313359),m=n(m,l,g,f,h[a+15],10,4264355552),f=n(f,m,l,g,h[a+6],15,2734768916),g=n(g,f,m,l,h[a+13],21,1309151649),l=n(l,g,f,m,h[a+4],6,4149444226),m=n(m,l,g,f,h[a+11],10,3174756917),f=n(f,m,l,g,h[a+2],15,718787259),g=n(g,f,m,l,h[a+9],21,3951481745),l=b(l,u),g=b(g,w),f=b(f,k),m=b(m,A);return(p(l)+p(g)+p(f)+p(m)).toLowerCase()};(function(a){a.fn.stupidtable=function(){a(this).on("click","thead th",function(){a(this).stupidsort()})};a.fn.stupidsort=function(){function b(b){var c=0,d;a(b).children("td,th").each(function(){if(c==u)return d=a(this),!1;var b=a(this).attr("colspan");c+=b?Number(b):1});b="undefined"!=typeof d.data("sort-value")?d.data("sort-value"):"undefined"!=typeof d.attr("data-sort-value")?d.attr("data-sort-value"):d.text();switch(p){case "string":case "string-ins":b=String(b).toLowerCase();break;case "int":b=
parseInt(Number(b));break;case "float":b=Number(b)}return b}var c=a(this),d=c.closest("table"),e=d.children("tbody"),n=e.children("tr"),p=c.attr("data-sort-type");if(p){var h=!0;c.hasClass("sorting-asc")&&(h=!1);var u=0;c.prevAll().each(function(){var b=a(this).attr("colspan");u+=b?Number(b):1});n.sort(function(a,c){var d=h?1:-1;a=b(a);c=b(c);return a>c?1*d:a<c?-1*d:0});e.append(n);d.find("thead th").removeClass("sorting-asc").removeClass("sorting-desc");c.addClass(h?"sorting-asc":"sorting-desc")}}})(jQuery);$(function(){UI.elements={menu:$("nav > .menu"),main:$("main"),header:$("header"),header_title:$("#header_title")};UI.buildMenu();UI.stored.getOpts();try{if("mistLogin"in sessionStorage){var a=JSON.parse(sessionStorage.mistLogin);mist.user.name=a.name;mist.user.password=a.password;mist.user.host=a.host}}catch(b){}location.hash&&(a=decodeURIComponent(location.hash).substring(1).split("@")[0].split("&"),mist.user.name=a[0],a[1]&&(mist.user.host=a[1]));mist.send(function(a){$(window).trigger("hashchange")},
{},{timeout:5,hide:!0});var c=0;$("body > div.filler").on("scroll",function(){var a=$(this).scrollLeft();a!=c&&UI.elements.header.css("margin-right",-1*a+"px");c=a})});$(window).on("hashchange",function(a){a=decodeURIComponent(location.hash).substring(1).split("@");a[1]||(a[1]="");a=a[1].split("&");""==a[0]&&(a[0]="Overview");UI.showTab(a[0],a[1])});
var MistVideoObject={},otherhost={host:!1,https:!1},UI={debug:!1,elements:{},stored:{getOpts:function(){var a=localStorage.stored;a&&(a=JSON.parse(a));$.extend(!0,this.vars,a);return this.vars},saveOpt:function(a,b){this.vars[a]=b;localStorage.stored=JSON.stringify(this.vars);return this.vars},vars:{helpme:!0}},interval:{clear:function(){"undefined"!=typeof this.opts&&(clearInterval(this.opts.id),delete this.opts)},set:function(a,b){this.opts&&log("[interval]","Set called on interval, but an interval is already active.");
this.opts={delay:b,callback:a};this.opts.id=setInterval(a,b)}},returnTab:["Overview"],countrylist:{AF:"Afghanistan",AX:"&Aring;land Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia, Plurinational State of",
BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CD:"Congo, the Democratic Republic of the",CK:"Cook Islands",
CR:"Costa Rica",CI:"C&ocirc;te d'Ivoire",HR:"Croatia",CU:"Cuba",CW:"Cura&ccedil;ao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",
GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City State)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",
KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People's Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, the former Yugoslav Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",
MD:"Moldova, Republic of",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestine, State of",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",
QA:"Qatar",RE:"R&eacute;union",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barth&eacute;lemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin (French part)",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",
SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and the South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan, Province of China",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",
TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"},tooltip:{show:function(a,b){$tooltip=this.element;$.contains(document.body,$tooltip[0])||$("body").append($tooltip);$tooltip.html(b);
clearTimeout(this.hiding);delete this.hiding;var c=$(document).height()-$tooltip.outerHeight(),d=$(document).width()-$tooltip.outerWidth();$tooltip.css("left",Math.min(a.pageX+10,d-10));$tooltip.css("top",Math.min(a.pageY+25,c-10));$tooltip.show().addClass("show")},hide:function(){$tooltip=this.element;$tooltip.removeClass("show");this.hiding=setTimeout(function(){$tooltip.hide()},500)},element:$("<div>").attr("id","tooltip")},humanMime:function(a){var b=!1;switch(a){case "html5/application/vnd.apple.mpegurl":b=
"HLS (TS)";break;case "html5/application/vnd.apple.mpegurl;version=7":b="HLS (CMAF)";break;case "html5/video/webm":b="WebM";break;case "html5/video/mp4":b="MP4";break;case "dash/video/mp4":b="DASH";break;case "flash/11":b="HDS";break;case "flash/10":b="RTMP";break;case "flash/7":b="Progressive";break;case "html5/audio/mp3":b="MP3";break;case "html5/audio/wav":b="WAV";break;case "html5/video/mp2t":case "html5/video/mpeg":b="TS";break;case "html5/application/vnd.ms-sstr+xml":case "html5/application/vnd.ms-ss":b=
"Smooth Streaming";break;case "html5/text/vtt":b="VTT Subtitles";break;case "html5/text/plain":b="SRT Subtitles";break;case "html5/text/javascript":b="JSON Subtitles";break;case "rtsp":b="RTSP";break;case "webrtc":b="WebRTC"}return b},popup:{element:null,show:function(a){this.element=$("<div>").attr("id","popup").append($("<button>").text("Close").addClass("close").click(function(){UI.popup.element.fadeOut("fast",function(){UI.popup.element.remove();UI.popup.element=null})})).append(a);$("body").append(this.element)}},
menu:[{Streams:{hiddenmenu:{Edit:{},Preview:{},Embed:{}}},Push:{LTSonly:!0},Triggers:{LTSonly:!1},Settings:{LTSonly:!1}},{BottomCard:{submenu:{Status:{value:"Connected"},Active:{value:0},Connections:{value:0}}}}],buildMenu:function(){function a(a,b){var c;c="submenu"in b?$("<div>").addClass("bottom"):$("<a>").addClass("button");"Streams"==a?c.html($('<svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M11.155 1.47153C8.33041 1.00949 5.4477 1.00949 2.62309 1.47153C1.00782 1.80449 0 2.83053 0 4.16915V8.92565C0 10.2846 1.00782 11.2971 2.6507 11.6436C4.05577 11.8765 5.478 11.9947 6.90286 11.997C6.20797 4.52249 12.5714 11.25 12.5714 11.25C13.974 10.8496 13.8057 10.2914 13.8057 8.93244V4.17594C13.8057 2.82374 12.7703 1.76372 11.155 1.47153ZM9.15319 6.86676L5.70176 8.90526C5.64777 8.93765 5.5855 8.95415 5.52229 8.95283C5.46236 8.95235 5.40333 8.9384 5.34971 8.91206C5.29544 8.87964 5.25087 8.83362 5.22055 8.7787C5.19023 8.7238 5.17525 8.66196 5.17714 8.59949V4.52249C5.17766 4.46231 5.19379 4.40326 5.22399 4.35094C5.25419 4.29862 5.29747 4.25475 5.34971 4.22351C5.40385 4.19496 5.46432 4.18002 5.52574 4.18002C5.58715 4.18002 5.64762 4.19496 5.70176 4.22351L9.15319 6.26201C9.20306 6.29332 9.24413 6.3365 9.27261 6.38758C9.301 6.43864 9.31592 6.49595 9.31592 6.55419C9.31592 6.61243 9.301 6.66973 9.27261 6.7208C9.24413 6.77187 9.20306 6.81506 9.15319 6.84638V6.86676Z" fill="#A3ACB9"></path><path d="M13.4407 5.97153C10.6161 5.50949 7.73335 5.50949 4.90873 5.97153C3.29346 6.30449 2.28564 7.33053 2.28564 8.66915V13.4256C2.28564 14.7846 3.29346 15.7971 4.93634 16.1436C6.34142 16.3765 7.76365 16.4947 9.1885 16.497C10.6177 16.4966 12.0446 16.3808 13.4545 16.1504C15.0559 15.8515 16.0914 14.7914 16.0914 13.4324V8.67594C16.0914 7.32374 15.0559 6.26372 13.4407 5.97153ZM11.4388 11.3668L7.9874 13.4053C7.93342 13.4376 7.87114 13.4542 7.80793 13.4528C7.74801 13.4524 7.68898 13.4384 7.63536 13.4121C7.58109 13.3796 7.53651 13.3336 7.5062 13.2787C7.47588 13.2238 7.4609 13.162 7.46279 13.0995V9.02249C7.46331 8.96231 7.47943 8.90326 7.50963 8.85094C7.53983 8.79862 7.58311 8.75475 7.63536 8.72351C7.68949 8.69496 7.74996 8.68002 7.81138 8.68002C7.8728 8.68002 7.93327 8.69496 7.9874 8.72351L11.4388 10.762C11.4887 10.7933 11.5298 10.8365 11.5583 10.8876C11.5866 10.9386 11.6016 10.9959 11.6016 11.0542C11.6016 11.1124 11.5866 11.1697 11.5583 11.2208C11.5298 11.2719 11.4887 11.3151 11.4388 11.3464V11.3668Z" fill="#4F566B"></path></g><defs><clipPath id="clip0"><rect width="16" height="18" fill="white"></rect></clipPath></defs></svg>')).append($("<span>").addClass("plain").text(a)):
"Streams"==a?c.html($('<svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M11.155 1.47153C8.33041 1.00949 5.4477 1.00949 2.62309 1.47153C1.00782 1.80449 0 2.83053 0 4.16915V8.92565C0 10.2846 1.00782 11.2971 2.6507 11.6436C4.05577 11.8765 5.478 11.9947 6.90286 11.997C6.20797 4.52249 12.5714 11.25 12.5714 11.25C13.974 10.8496 13.8057 10.2914 13.8057 8.93244V4.17594C13.8057 2.82374 12.7703 1.76372 11.155 1.47153ZM9.15319 6.86676L5.70176 8.90526C5.64777 8.93765 5.5855 8.95415 5.52229 8.95283C5.46236 8.95235 5.40333 8.9384 5.34971 8.91206C5.29544 8.87964 5.25087 8.83362 5.22055 8.7787C5.19023 8.7238 5.17525 8.66196 5.17714 8.59949V4.52249C5.17766 4.46231 5.19379 4.40326 5.22399 4.35094C5.25419 4.29862 5.29747 4.25475 5.34971 4.22351C5.40385 4.19496 5.46432 4.18002 5.52574 4.18002C5.58715 4.18002 5.64762 4.19496 5.70176 4.22351L9.15319 6.26201C9.20306 6.29332 9.24413 6.3365 9.27261 6.38758C9.301 6.43864 9.31592 6.49595 9.31592 6.55419C9.31592 6.61243 9.301 6.66973 9.27261 6.7208C9.24413 6.77187 9.20306 6.81506 9.15319 6.84638V6.86676Z" fill="#A3ACB9"></path><path d="M13.4407 5.97153C10.6161 5.50949 7.73335 5.50949 4.90873 5.97153C3.29346 6.30449 2.28564 7.33053 2.28564 8.66915V13.4256C2.28564 14.7846 3.29346 15.7971 4.93634 16.1436C6.34142 16.3765 7.76365 16.4947 9.1885 16.497C10.6177 16.4966 12.0446 16.3808 13.4545 16.1504C15.0559 15.8515 16.0914 14.7914 16.0914 13.4324V8.67594C16.0914 7.32374 15.0559 6.26372 13.4407 5.97153ZM11.4388 11.3668L7.9874 13.4053C7.93342 13.4376 7.87114 13.4542 7.80793 13.4528C7.74801 13.4524 7.68898 13.4384 7.63536 13.4121C7.58109 13.3796 7.53651 13.3336 7.5062 13.2787C7.47588 13.2238 7.4609 13.162 7.46279 13.0995V9.02249C7.46331 8.96231 7.47943 8.90326 7.50963 8.85094C7.53983 8.79862 7.58311 8.75475 7.63536 8.72351C7.68949 8.69496 7.74996 8.68002 7.81138 8.68002C7.8728 8.68002 7.93327 8.69496 7.9874 8.72351L11.4388 10.762C11.4887 10.7933 11.5298 10.8365 11.5583 10.8876C11.5866 10.9386 11.6016 10.9959 11.6016 11.0542C11.6016 11.1124 11.5866 11.1697 11.5583 11.2208C11.5298 11.2719 11.4887 11.3151 11.4388 11.3464V11.3668Z" fill="#4F566B"></path></g><defs><clipPath id="clip0"><rect width="16" height="18" fill="white"></rect></clipPath></defs></svg>')).append($("<span>").addClass("plain").text(a)):
"Push"==a?c.html($('\n              <svg width="15" height="12" viewBox="0 0 15 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M10 0.666656C10.368 0.666656 10.6667 0.965323 10.6667 1.33332V4.13332L14.142 1.69999C14.2927 1.59466 14.5007 1.63132 14.6067 1.78266C14.6453 1.83866 14.6667 1.90532 14.6667 1.97332V10.0267C14.6667 10.2107 14.5173 10.36 14.3333 10.36C14.2647 10.36 14.198 10.3387 14.142 10.3L10.6667 7.86666V10.6667C10.6667 11.0347 10.368 11.3333 10 11.3333H0.666667C0.298667 11.3333 0 11.0347 0 10.6667V1.33332C0 0.965323 0.298667 0.666656 0.666667 0.666656H10ZM5.33333 3.33332L2.66667 5.99999H4.66667V8.66666H6V5.99999H8L5.33333 3.33332Z" fill="#5F5B7B"/>\n              </svg>\n              ')).append($("<span>").addClass("plain").text(a)):
"Triggers"==a?c.html($('\n              <svg width="12" height="14" viewBox="0 0 12 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M3.33333 2.33334H5.33333V8.33334H3.33333V10.3333H2V8.33334H0V2.33334H2V0.333344H3.33333V2.33334ZM10 5.66668H12V11.6667H10V13.6667H8.66667V11.6667H6.66667V5.66668H8.66667V3.66668H10V5.66668Z" fill="#515669"/>\n              </svg>\n              ')).append($("<span>").addClass("plain").text(a)):"Settings"==a&&c.html($('\n              <svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M2.80811 1.72418C3.6725 0.949881 4.68778 0.362845 5.79007 0C6.10525 0.394863 6.50538 0.713605 6.96072 0.932527C7.41606 1.15145 7.91488 1.26492 8.42011 1.26451C8.92534 1.26492 9.42417 1.15145 9.8795 0.932527C10.3348 0.713605 10.735 0.394863 11.0502 0C12.1524 0.362845 13.1677 0.949881 14.0321 1.72418C13.8482 2.19433 13.7725 2.69987 13.8107 3.20327C13.8488 3.70668 13.9999 4.19502 14.2527 4.63204C14.5049 5.0699 14.8526 5.44526 15.2699 5.73022C15.6872 6.01517 16.1634 6.20238 16.663 6.27793C16.8992 7.41354 16.8992 8.58561 16.663 9.72123C15.6864 9.87109 14.7856 10.4453 14.2527 11.3671C13.9998 11.8042 13.8486 12.2927 13.8105 12.7963C13.7723 13.2999 13.848 13.8056 14.0321 14.2758C13.1676 15.0498 12.1524 15.6366 11.0502 15.9992C10.7349 15.6044 10.3347 15.2859 9.87939 15.0671C9.42406 14.8483 8.92527 14.735 8.42011 14.7355C7.91488 14.7351 7.41606 14.8485 6.96072 15.0675C6.50538 15.2864 6.10525 15.6051 5.79007 16C4.68785 15.6374 3.67258 15.0507 2.80811 14.2767C2.99219 13.8064 3.06795 13.3007 3.02977 12.7971C2.99158 12.2936 2.84043 11.8051 2.58754 11.368C2.33522 10.9303 1.98749 10.5551 1.57019 10.2703C1.1529 9.98545 0.676781 9.79837 0.177228 9.72291C-0.0590761 8.58703 -0.0590761 7.41466 0.177228 6.27877C0.676857 6.20322 1.15303 6.01601 1.57032 5.73106C1.98762 5.4461 2.33531 5.07074 2.58754 4.63289C2.8403 4.19586 2.99138 3.70752 3.02956 3.20412C3.06775 2.70071 2.99206 2.19517 2.80811 1.72502V1.72418ZM9.68294 10.1868C9.97249 10.0222 10.2266 9.80189 10.4307 9.53864C10.6348 9.2754 10.7848 8.97439 10.872 8.65295C10.9593 8.3315 10.9821 7.99596 10.9392 7.66566C10.8963 7.33535 10.7884 7.0168 10.6219 6.72835C10.4553 6.43989 10.2334 6.18723 9.96879 5.9849C9.7042 5.78258 9.4022 5.63458 9.08018 5.54945C8.75816 5.46431 8.42248 5.44371 8.09247 5.48883C7.76246 5.53396 7.44463 5.64391 7.15729 5.81237C6.58193 6.14967 6.16334 6.70085 5.99287 7.34564C5.82239 7.99043 5.91388 8.67647 6.24736 9.25406C6.58084 9.83164 7.12923 10.2539 7.77288 10.4286C8.41652 10.6034 9.10315 10.5164 9.68294 10.1868Z" fill="#515669"/>\n              </svg>\n              ')).append($("<span>").addClass("plain").text(a));
for(var d in b.classes)c.addClass(b.classes[d]);"LTSonly"in b&&c.addClass("LTSonly");"link"in b?c.attr("href",b.link).attr("target","_blank"):"submenu"in b||c.click(function(b){$(this).closest(".menu").hasClass("hide")||(UI.navto(a),b.stopPropagation())});return c}var b=UI.elements.menu,c;for(c in UI.menu){0<c&&b.append($("<br>"));for(var d in UI.menu[c]){var e=UI.menu[c][d],n=a(d,e);b.append(n);if("submenu"in e){var p=mist.data.active_streams?mist.data.active_streams.length:0,h;for(h in e.submenu){var u=
$("<div>").addClass("submenu item");u.append($("<div>").addClass("title").text(h));u.append($("<div>").addClass("value").text("Active"==h?p:e.submenu[h].value));n.append(u)}}else if("hiddenmenu"in e)for(h in u=$("<span>").addClass("hiddenmenu"),n.append(u),e.hiddenmenu)u.append(a(h,e.hiddenmenu[h]))}}},findInput:function(a){return this.findInOutput("inputs",a)},findOutput:function(a){return this.findInOutput("connectors",a)},findInOutput:function(a,b){if("capabilities"in mist.data){var c=!1,d=mist.data.capabilities[a];
b in d&&(c=d[b]);b+".exe"in d&&(c=d[b+".exe"]);return c}throw"Request capabilities first";},buildUI:function(a){var b=$("<div>").addClass("input_container"),c;for(c in a){var d=a[c];if(d instanceof jQuery)b.append(d);else if("help"==d.type){var e=$("<span>").addClass("text_container").append($("<span>").addClass("description").append(d.help));b.append(e);if("classes"in d)for(var n in d.classes)e.addClass(d.classes[n])}else if("text"==d.type)b.append($("<span>").addClass("text_container").append($("<span>").addClass("text").append(d.text)));
else if("custom"==d.type)b.append(d.custom);else if("buttons"==d.type)for(n in e=$("<span>").addClass("button_container").on("keydown",function(a){a.stopPropagation()}),"css"in d&&e.css(d.css),b.append(e),d.buttons){var p=d.buttons[n],h=$("<button>").text(p.label).data("opts",p);"css"in p&&h.css(p.css);if("classes"in p)for(var u in p.classes)h.addClass(p.classes[u]);e.append(h);switch(p.type){case "cancel":h.addClass("cancel").click(p["function"]);break;case "save":h.addClass("save").click(function(a){(a=
$(this).data("opts").preSave)&&a.call(this);var b=$(this).closest(".input_container"),c=!1;b.find('.hasValidate:visible, input[type="hidden"].hasValidate').each(function(){if(c=$(this).data("validate")(this,!0))return!1});(a=$(this).data("opts").failedValidate)&&a.call(this);c||(b.find('.isSetting:visible, input[type="hidden"].isSetting').each(function(){var a=$(this).getval(),b=$(this).data("pointer");if(""===a)if("default"in $(this).data("opts"))a=$(this).data("opts")["default"];else return b.main[b.index]=
null,!0;b.main[b.index]=a}),(a=$(this).data("opts")["function"])&&a(this))});break;default:h.click(p["function"])}}else{p=$("<label>").addClass("UIelement");b.append(p);"css"in d&&p.css(d.css);p.append($("<span>").addClass("label").html("label"in d?d.label+":":""));if("classes"in d)for(u in d.classes)p.addClass(d.classes[u]);h=$("<span>").addClass("field_container");p.append(h);switch(d.type){case "password":e=$("<input>").attr("type","password");break;case "int":e=$("<input>").attr("type","number");
"min"in d&&e.attr("min",d.min);"max"in d&&e.attr("max",d.max);"step"in d&&e.attr("step",d.step);"validate"in d?d.validate.push("int"):d.validate=["int"];break;case "span":e=$("<span>");break;case "debug":d.select=[["","Default"],[0,"0 - All debugging messages disabled"],[1,"1 - Messages about failed operations"],[2,"2 - Previous level, and error messages"],[3,"3 - Previous level, and warning messages"],[4,"4 - Previous level, and status messages for development"],[5,"5 - Previous level, and more status messages for development"],
[6,"6 - Previous level, and verbose debugging messages"],[7,"7 - Previous level, and very verbose debugging messages"],[8,"8 - Report everything in extreme detail"],[9,"9 - Report everything in insane detail"],[10,"10 - All messages enabled"]];case "select":e=$("<select>");for(n in d.select){var w=$("<option>");"string"==typeof d.select[n]?w.text(d.select[n]):w.val(d.select[n][0]).text(d.select[n][1]);e.append(w)}break;case "textarea":e=$("<textarea>").on("keydown",function(a){a.stopPropagation()});
break;case "checkbox":e=$("<input>").attr("type","checkbox");break;case "hidden":e=$("<input>").attr("type","hidden");p.hide();break;case "email":e=$("<input>").attr("type","email").attr("autocomplete","on").attr("required","");break;case "browse":e=$("<input>").attr("type","text");"filetypes"in d&&e.data("filetypes",d.filetypes);break;case "geolimited":case "hostlimited":e=$("<input>").attr("type","hidden");break;case "radioselect":e=$("<div>").addClass("radioselect");for(c in d.radioselect){var k=
$("<input>").attr("type","radio").val(d.radioselect[c][0]).attr("name",d.label);("LTSonly"in d&&!mist.data.LTS||d.readonly)&&k.prop("disabled",!0);w=$("<label>").append(k).append($("<span>").html(d.radioselect[c][1]));e.append(w);if(2<d.radioselect[c].length)for(n in k=$("<select>").change(function(){$(this).parent().find("input[type=radio]:enabled").prop("checked","true")}),w.append(k),("LTSonly"in d&&!mist.data.LTS||d.readonly)&&k.prop("disabled",!0),d.radioselect[c][2])w=$("<option>"),k.append(w),
d.radioselect[c][2][n]instanceof Array?w.val(d.radioselect[c][2][n][0]).html(d.radioselect[c][2][n][1]):w.html(d.radioselect[c][2][n])}break;case "checklist":e=$("<div>").addClass("checkcontainer");$controls=$("<div>").addClass("controls");$checklist=$("<div>").addClass("checklist");e.append($checklist);for(c in d.checklist)"string"==typeof d.checklist[c]&&(d.checklist[c]=[d.checklist[c],d.checklist[c]]),$checklist.append($("<label>").text(d.checklist[c][1]).prepend($("<input>").attr("type","checkbox").attr("name",
d.checklist[c][0])));break;case "DOMfield":e=d.DOMfield;break;case "unix":e=$("<input>").attr("type","datetime-local").attr("step",1);d.unit=$("<button>").text("Now").click(function(){$(this).closest(".field_container").find(".field").setval((new Date).getTime()/1E3)});break;case "selectinput":e=$("<div>").addClass("selectinput");k=$("<select>");e.append(k);k.data("input",!1);"LTSonly"in d&&!mist.data.LTS&&k.prop("disabled",!0);for(c in d.selectinput)w=$("<option>"),k.append(w),"string"==typeof d.selectinput[c]?
w.text(d.selectinput[c]):(w.text(d.selectinput[c][1]),"string"==typeof d.selectinput[c][0]?w.val(d.selectinput[c][0]):(w.val("CUSTOM"),k.data("input")||k.data("input",UI.buildUI([d.selectinput[c][0]]).children())));k.data("input")&&e.append(k.data("input"));k.change(function(){"CUSTOM"==$(this).val()?$(this).data("input").css("display","flex"):$(this).data("input").hide()});k.trigger("change");break;case "inputlist":e=$("<div>").addClass("inputlist");e.data("newitem",function(){var a=$("<input>").attr("type",
"text").addClass("listitem");("LTSonly"in d&&!mist.data.LTS||d.readonly)&&a.prop("disabled",!0);var b=function(c){$(this).is(":last-child")?""!=$(this).val()?$(this).after(a.clone().keyup(b).val("")):8==c.which&&$(this).prev().focus():""==$(this).val()&&($(this).next().focus(),$(this).remove())};a.keyup(b);return a});e.append(e.data("newitem"));break;case "sublist":e=$("<div>").addClass("sublist");k=$("<div>").addClass("curvals");k.append($("<span>").text("None."));var A=$("<div>").addClass("itemsettings"),
l=$("<button>").text("New "+d.itemLabel),g=d.sublist,f=d,m=e,T=p;e.data("build",function(a,b){for(var c in f.saveas)c in a||delete f.saveas[c];f.saveas=Object.assign(f.saveas,a);c="New";"undefined"!=typeof b&&(c="Edit");c=UI.buildUI([$("<h4>").text(c+" "+f.itemLabel)].concat(g).concat([{label:"Save first",type:"str",classes:["onlyshowhelp"],validate:[function(){return{msg:"Did you want to save this "+f.itemLabel+"?",classes:["red"]}}]},{type:"buttons",buttons:[{label:"Cancel",type:"cancel",function:function(){A.html("");
l.show();T.show()}},{label:"Save "+f.itemLabel,type:"save",preSave:function(){$(this).closest(".input_container").find(".onlyshowhelp").closest("label").hide()},failedValidate:function(){$(this).closest(".input_container").find(".onlyshowhelp").closest("label").show()},function:function(){var a=m.getval(),c=Object.assign({},f.saveas),d;for(d in c)null===c[d]&&delete c[d];"undefined"==typeof b?a.push(c):a[b]=c;m.setval(a);A.html("");l.show();T.show()}}]}]));A.html(c);l.hide();T.hide()});var J=e;l.click(function(){J.data("build")({})});
g.unshift({type:"str",label:"Human readable name",placeholder:"none",help:"A convenient name to describe this "+d.itemLabel+". It won't be used by MistServer.",pointer:{main:d.saveas,index:"x-LSP-name"}});e.data("savelist",[]);e.append(k).append(l);b.append(A);break;case "json":e=$("<textarea>").on("keydown",function(a){a.stopPropagation()}).on("keyup change",function(a){this.style.height="";this.style.height=(this.scrollHeight?this.scrollHeight+20:14*this.value.split("\n").length+20)+"px"}).css("min-height",
"3em");k=function(a,b){if(""!=$(b).val()&&null===a)return{msg:"Invalid json",classes:["red"]}};"validate"in d?d.validate.push(k):d.validate=[k];break;default:e=$("<input>").attr("type","text")}e.addClass("field").data("opts",d);"pointer"in d&&e.attr("name",d.pointer.index);h.append(e);if("classes"in d)for(n in d.classes)e.addClass(d.classes[n]);"placeholder"in d&&e.attr("placeholder",d.placeholder);"default"in d&&e.attr("placeholder",d["default"]);"unit"in d&&h.append($("<span>").addClass("unit").html(d.unit));
"readonly"in d&&(e.attr("readonly","readonly"),e.click(function(){$(this).select()}));"qrcode"in d&&h.append($("<span>").addClass("unit").html($("<button>").text("QR").on("keydown",function(a){a.stopPropagation()}).click(function(){var a=String($(this).closest(".field_container").find(".field").getval()),b=$("<div>").addClass("qrcode");UI.popup.show($("<span>").addClass("qr_container").append($("<p>").text(a)).append(b));b.qrcode({text:a,size:Math.min(b.width(),b.height())})})));"clipboard"in d&&
document.queryCommandSupported("copy")&&h.append($("<span>").addClass("unit").html($("<button>").text("Copy").on("keydown",function(a){a.stopPropagation()}).click(function(){var a=String($(this).closest(".field_container").find(".field").getval()),b=document.createElement("textarea");b.value=a;document.body.appendChild(b);b.select();var c=!1;try{c=document.execCommand("copy")}catch(d){}if(c){$(this).text("Copied to clipboard!");document.body.removeChild(b);var f=$(this);setTimeout(function(){f.text("Copy")},
5E3)}else document.body.removeChild(b),alert("Failed to copy:\n"+a)})));"rows"in d&&e.attr("rows",d.rows);"LTSonly"in d&&!mist.data.LTS&&(h.addClass("LTSonly"),e.prop("disabled",!0));if("dependent"in d)for(c in d.dependent)p.attr("data-dependent-"+c,d.dependent[c]);switch(d.type){case "browse":k=$("<div>").addClass("grouper").append(p);b.append(k);k=$("<button>").text("Browse").on("keydown",function(a){a.stopPropagation()});h.append(k);k.click(function(){function a(b){h.text("Loading..");mist.send(function(a){e.text(a.browse.path[0]);
mist.data.LTS&&d.setval(a.browse.path[0]+"/");h.html(m.clone(!0).text("..").attr("title","Folder up"));if(a.browse.subdirectories){a.browse.subdirectories.sort();for(var b in a.browse.subdirectories){var g=a.browse.subdirectories[b];h.append(m.clone(!0).attr("title",e.text()+p+g).text(g))}}if(a.browse.files)for(b in a.browse.files.sort(),a.browse.files){var g=a.browse.files[b],k=e.text()+p+g,g=$("<a>").text(g).addClass("file").attr("title",k);h.append(g);if(l){var n=!0,u;for(u in l)if("undefined"!=
typeof l[u]&&mist.inputMatch(l[u],k)){n=!1;break}n&&g.hide()}g.click(function(){var a=$(this).attr("title");d.setval(a).removeAttr("readonly").css("opacity",1);f.show();c.remove()})}},{browse:b})}var b=$(this).closest(".grouper"),c=$("<div>").addClass("browse_container"),d=b.find(".field").attr("readonly","readonly").css("opacity",.5),f=$(this),g=$("<button>").text("Stop browsing").click(function(){f.show();c.remove();d.removeAttr("readonly").css("opacity",1)}),e=$("<span>").addClass("field"),h=$("<div>").addClass("browse_contents"),
m=$("<a>").addClass("folder"),l=d.data("filetypes");b.append(c);c.append($("<label>").addClass("UIelement").append($("<span>").addClass("label").text("Current folder:")).append($("<span>").addClass("field_container").append(e).append(g))).append(h);var p="/";-1<mist.data.config.version.indexOf("indows")&&(p="\\");m.click(function(){var b=e.text()+p+$(this).text();a(b)});b=d.getval();g=b.split("://");1<g.length&&(b="file"==g[0]?g[1]:"");b=b.split(p);b.pop();b=b.join(p);f.hide();a(b)});break;case "geolimited":case "hostlimited":k=
{field:e};k.blackwhite=$("<select>").append($("<option>").val("-").text("Blacklist")).append($("<option>").val("+").text("Whitelist"));k.values=$("<span>").addClass("limit_value_list");switch(d.type){case "geolimited":k.prototype=$("<select>").append($("<option>").val("").text("[Select a country]"));for(c in UI.countrylist)k.prototype.append($("<option>").val(c).html(UI.countrylist[c]));break;case "hostlimited":k.prototype=$("<input>").attr("type","text").attr("placeholder","type a host")}k.prototype.on("change keyup",
function(){$(this).closest(".field_container").data("subUI").blackwhite.trigger("change")});k.blackwhite.change(function(){var a=$(this).closest(".field_container").data("subUI"),b=[],c=!1;a.values.children().each(function(){c=$(this).val();""!=c?b.push(c):$(this).remove()});a.values.append(a.prototype.clone(!0));0<b.length?a.field.val($(this).val()+b.join(" ")):a.field.val("");a.field.trigger("change")});"LTSonly"in d&&!mist.data.LTS&&(k.blackwhite.prop("disabled",!0),k.prototype.prop("disabled",
!0));k.values.append(k.prototype.clone(!0));h.data("subUI",k).addClass("limit_list").append(k.blackwhite).append(k.values)}"pointer"in d&&(e.data("pointer",d.pointer).addClass("isSetting"),d.pointer.main&&(k=d.pointer.main[d.pointer.index],"undefined"!=k&&e.setval(k)));(""==e.getval()||null==e.getval())&&"value"in d&&e.setval(d.value);if("datalist"in d)for(c in k="datalist_"+c+MD5(e[0].outerHTML),e.attr("list",k),k=$("<datalist>").attr("id",k),h.append(k),d.datalist)k.append($("<option>").val(d.datalist[c]));
h=$("<span>").addClass("help_container");p.append(h);"help"in d&&(h.append($("<span>").addClass("ih_balloon").html(d.help)),e.on("focus mouseover",function(){$(this).closest("label").addClass("active")}).on("blur mouseout",function(){$(this).closest("label").removeClass("active")}));if("validate"in d){p=[];for(n in d.validate){k=d.validate[n];if("function"!=typeof k)switch(k){case "required":k=function(a,b){return""==a||null==a?{msg:"This is a required field.",classes:["red"]}:!1};break;case "int":k=
function(a,b){var c=$(b).data("opts");if(!$(b)[0].validity.valid){var d=[];"min"in c&&d.push(" greater than or equal to "+c.min);"max"in c&&d.push(" smaller than or equal to "+c.max);return{msg:"Please enter an integer"+d.join(" and")+".",classes:["red"]}}};break;case "streamname":k=function(a,b){if(""!=a){if(!isNaN(a.charAt(0)))return{msg:"The first character may not be a number.",classes:["red"]};if(a.toLowerCase()!=a)return{msg:"Uppercase letters are not allowed.",classes:["red"]};if(a.replace(/[^\da-z_]/g,
"")!=a)return{msg:"Special characters (except for underscores) are not allowed.",classes:["red"]};if("streams"in mist.data&&a in mist.data.streams&&$(b).data("pointer").main.name!=a)return{msg:"This streamname already exists.<br>If you want to edit an existing stream, please click edit on the the streams tab.",classes:["red"]}}};break;case "streamname_with_wildcard":k=function(a,b){if(""!=a){streampart=a.split("+");var c=streampart.slice(1).join("+");streampart=streampart[0];if(!isNaN(streampart.charAt(0)))return{msg:"The first character may not be a number.",
classes:["red"]};if(streampart.toLowerCase()!=streampart)return{msg:"Uppercase letters are not allowed in a stream name.",classes:["red"]};if(streampart.replace(/[^\da-z_]/g,"")!=streampart)return{msg:"Special characters (except for underscores) are not allowed in a stream name.",classes:["red"]};if(streampart!=a&&c.replace(/[\00|\0|\/]/g,"")!=c)return{msg:"Slashes or null bytes are not allowed in wildcards.",classes:["red"]}}};break;case "streamname_with_wildcard_and_variables":k=function(a,b){if(""!=
a){streampart=a.split("+");var c=streampart.slice(1).join("+");streampart=streampart[0];if(!isNaN(streampart.charAt(0)))return{msg:"The first character may not be a number.",classes:["red"]};if(streampart.toLowerCase()!=streampart)return{msg:"Uppercase letters are not allowed in a stream name.",classes:["red"]};if(streampart.replace(/[^\da-z_$]/g,"")!=streampart)return{msg:"Special characters (except for underscores) are not allowed in a stream name.",classes:["red"]};if(streampart!=a&&c.replace(/[\00|\0|\/]/g,
"")!=c)return{msg:"Slashes or null bytes are not allowed in wildcards.",classes:["red"]}}};break;default:k=function(){}}p.push(k)}e.data("validate_functions",p).data("help_container",h).data("validate",function(a,b){if($(a).is(":visible")||$(a).is('input[type="hidden"]')){var c=$(a).getval(),d=$(a).data("validate_functions"),f=$(a).data("help_container");f.find(".err_balloon").remove();for(var g in d){var e=d[g](c,a);if(e){$err=$("<span>").addClass("err_balloon").html(e.msg);for(var h in e.classes)$err.addClass(e.classes[h]);
f.prepend($err);b&&$(a).focus();return"object"==typeof e&&"break"in e?e["break"]:!0}}return!1}}).addClass("hasValidate").on("change keyup",function(){$(this).data("validate")($(this))});""!=e.getval()&&e.trigger("change")}"function"in d&&(e.on("change keyup",d["function"]),e.trigger("change"))}}b.on("keydown",function(a){var b=!1;switch(a.which){case 13:b=$(this).find("button.save").first();break;case 27:b=$(this).find("button.cancel").first()}b&&b.length&&(b.trigger("click"),a.stopPropagation())});
return b},buildVheaderTable:function(a){var b=$("<table>").css("margin","0.2em"),c=$("<tr>").addClass("header").append($("<td>").addClass("vheader").attr("rowspan",a.labels.length+1).append($("<span>").text(a.vheader))),d=[];c.append($("<td>"));for(var e in a.labels)d.push($("<tr>").append($("<td>").html(""==a.labels[e]?"&nbsp;":a.labels[e]+":")));for(var n in a.content)for(e in c.append($("<td>").html(a.content[n].header)),a.content[n].body)d[e].append($("<td>").html(a.content[n].body[e]));b.append($("<tbody>").append(c).append(d));
return b},plot:{addGraph:function(a,b){var c={id:a.id,xaxis:a.xaxis,datasets:[],elements:{cont:$("<div>").addClass("graph"),plot:$("<div>").addClass("plot"),legend:$("<div>").addClass("legend").attr("draggable","true")}};UI.draggable(c.elements.legend);c.elements.cont.append(c.elements.plot).append(c.elements.legend);b.append(c.elements.cont);return c},go:function(a){if(!(1>Object.keys(a).length)){var b={totals:[],clients:[]},c;for(c in a)for(var d in a[c].datasets){var e=a[c].datasets[d];switch(e.datatype){case "clients":case "upbps":case "downbps":case "perc_lost":case "perc_retrans":switch(e.origin[0]){case "total":b.totals.push({fields:[e.datatype],
end:-15});break;case "stream":b.totals.push({fields:[e.datatype],streams:[e.origin[1]],end:-15});break;case "protocol":b.totals.push({fields:[e.datatype],protocols:[e.origin[1]],end:-15})}break;case "cpuload":case "memload":b.capabilities={}}}0==b.totals.length&&delete b.totals;0==b.clients.length&&delete b.clients;mist.send(function(){for(var b in a){var c=a[b];if(1>c.datasets.length){c.elements.plot.html("");c.elements.legend.html("");break}switch(c.xaxis){case "time":var d=function(a){var b=c.elements.legend.find(".value"),
d=1;if("undefined"==typeof a)b.eq(0).html("Latest:");else{var e=c.plot.getXAxes()[0];a=Math.min(e.max,a);a=Math.max(e.min,a);b.eq(0).html(UI.format.time(a/1E3))}for(var h in c.datasets){var l="&nbsp;";if(c.datasets[h].display){var e=UI.plot.yaxes[c.datasets[h].yaxistype].tickFormatter,k=c.datasets[h].data;if(a)for(var n in k){if(k[n][0]==a){l=e(k[n][1]);break}if(k[n][0]>a){0!=n&&(l=k[n],k=k[n-1],l=e(l[1]+(a-l[0])*(k[1]-l[1])/(k[0]-l[0])));break}}else l=e(c.datasets[h].data[c.datasets[h].data.length-
1][1])}b.eq(d).html(l);d++}},e=[];c.yaxes={};var w=[],k;for(k in c.datasets){var A=c.datasets[k];A.display&&(A.getdata(),A.yaxistype in c.yaxes||(e.push(UI.plot.yaxes[A.yaxistype]),c.yaxes[A.yaxistype]=e.length),A.yaxis=c.yaxes[A.yaxistype],w.push(A))}e[0]&&(e[0].color=0);c.plot=$.plot(c.elements.plot,w,{legend:{show:!1},xaxis:UI.plot.xaxes[c.xaxis],yaxes:e,grid:{hoverable:!0,borderWidth:{top:0,right:0,bottom:1,left:1},color:"black",backgroundColor:{colors:["rgba(0,0,0,0)","rgba(0,0,0,0.025)"]}},
crosshair:{mode:"x"}});e=$("<table>").addClass("legend-list").addClass("nolay").html($("<tr>").html($("<td>").html($("<h3>").text(c.id))).append($("<td>").css("padding-right","2em").css("text-align","right").html($("<span>").addClass("value")).append($("<button>").data("opts",c).text("X").addClass("close").click(function(){var b=$(this).data("opts");if(confirm("Are you sure you want to remove "+b.id+"?")){b.elements.cont.remove();var c=$(".graph_ids option:contains("+b.id+")"),d=c.parent();c.remove();
UI.plot.del(b.id);delete a[b.id];d.trigger("change");UI.plot.go(a)}}))));c.elements.legend.html(e);c.plot.getOptions();for(k in c.datasets)w=$("<input>").attr("type","checkbox").data("index",k).data("graph",c).click(function(){var a=$(this).data("graph");$(this).is(":checked")?a.datasets[$(this).data("index")].display=!0:a.datasets[$(this).data("index")].display=!1;var b={};b[a.id]=a;UI.plot.go(b)}),c.datasets[k].display&&w.attr("checked","checked"),e.append($("<tr>").html($("<td>").html($("<label>").html(w).append($("<div>").addClass("series-color").css("background-color",
c.datasets[k].color)).append(c.datasets[k].label))).append($("<td>").css("padding-right","2em").css("text-align","right").html($("<span>").addClass("value")).append($("<button>").text("X").addClass("close").data("index",k).data("graph",c).click(function(){var b=$(this).data("index"),c=$(this).data("graph");if(confirm("Are you sure you want to remove "+c.datasets[b].label+" from "+c.id+"?"))if(c.datasets.splice(b,1),0==c.datasets.length){c.elements.cont.remove();var b=$(".graph_ids option:contains("+
c.id+")"),d=b.parent();b.remove();d.trigger("change");UI.plot.del(c.id);delete a[c.id];UI.plot.go(a)}else UI.plot.save(c),b={},b[c.id]=c,UI.plot.go(b)}))));d();var l=!1;c.elements.plot.on("plothover",function(a,b,c){b.x!=l&&(d(b.x),l=b.x);c?(a=$("<span>").append($("<h3>").text(c.series.label).prepend($("<div>").addClass("series-color").css("background-color",c.series.color))).append($("<table>").addClass("nolay").html($("<tr>").html($("<td>").text("Time:")).append($("<td>").html(UI.format.dateTime(c.datapoint[0]/
1E3,"long")))).append($("<tr>").html($("<td>").text("Value:")).append($("<td>").html(c.series.yaxis.tickFormatter(c.datapoint[1],c.series.yaxis))))),UI.tooltip.show(b,a.children())):UI.tooltip.hide()}).on("mouseout",function(){d()})}}},b)}},save:function(a){var b={id:a.id,xaxis:a.xaxis,datasets:[]},c;for(c in a.datasets)b.datasets.push({origin:a.datasets[c].origin,datatype:a.datasets[c].datatype});a=mist.stored.get().graphs||{};a[b.id]=b;mist.stored.set("graphs",a)},del:function(a){var b=mist.stored.get().graphs||
{};delete b[a];mist.stored.set("graphs",b)},datatype:{getOptions:function(a){var b=$.extend(!0,{},UI.plot.datatype.templates.general),c=$.extend(!0,{},UI.plot.datatype.templates[a.datatype]);a=$.extend(!0,c,a);a=$.extend(!0,b,a);switch(a.origin[0]){case "total":switch(a.datatype){case "cpuload":case "memload":break;default:a.label+=" (total)"}break;case "stream":case "protocol":a.label+=" ("+a.origin[1]+")"}var b=[],d;for(d in a.basecolor)c=a.basecolor[d],c+=50*(.5-Math.random()),c=Math.round(c),
c=Math.min(255,Math.max(0,c)),b.push(c);a.color="rgb("+b.join(",")+")";return a},templates:{general:{display:!0,datatype:"general",label:"",yaxistype:"amount",data:[],lines:{show:!0},points:{show:!1},getdata:function(){var a=mist.data.totals["stream"==this.origin[0]?this.origin[1]:"all_streams"]["protocol"==this.origin[0]?this.origin[1]:"all_protocols"][this.datatype];return this.data=a}},cpuload:{label:"CPU use",yaxistype:"percentage",basecolor:[237,194,64],cores:1,getdata:function(a){a=!1;for(var b in this.data)this.data[b][0]<
1E3*(mist.data.config.time-600)&&(a=b);!1!==a&&this.data.splice(0,Number(a)+1);this.data.push([1E3*mist.data.config.time,mist.data.capabilities.cpu_use/10]);return this.data}},memload:{label:"Memory load",yaxistype:"percentage",basecolor:[175,216,248],getdata:function(){var a=!1,b;for(b in this.data)this.data[b][0]<1E3*(mist.data.config.time-600)&&(a=b);!1!==a&&this.data.splice(0,Number(a)+1);this.data.push([1E3*mist.data.config.time,mist.data.capabilities.load.memory]);return this.data}},clients:{label:"Connections",
basecolor:[203,75,75]},upbps:{label:"Bandwidth up",yaxistype:"bytespersec",basecolor:[77,167,77]},downbps:{label:"Bandwidth down",yaxistype:"bytespersec",basecolor:[148,64,237]},perc_lost:{label:"Lost packages",yaxistype:"percentage",basecolor:[255,33,234]},perc_retrans:{label:"Re-transmitted packages",yaxistype:"percentage",basecolor:[0,0,255]}}},yaxes:{percentage:{name:"percentage",color:"black",tickColor:0,tickDecimals:0,tickFormatter:function(a,b){return UI.format.addUnit(UI.format.number(a),
"%")},tickLength:0,min:0,max:100},amount:{name:"amount",color:"black",tickColor:0,tickDecimals:0,tickFormatter:function(a,b){return UI.format.number(a)},tickLength:0,min:0},bytespersec:{name:"bytespersec",color:"black",tickColor:0,tickDecimals:1,tickFormatter:function(a,b){return UI.format.bytes(a,!0)},tickLength:0,ticks:function(a,b,c,d,e){b=.3*Math.sqrt($(".graph").first().height());b=(a.max-a.min)/b;c=Math.floor(Math.log(Math.abs(b))/Math.log(1024));var n=b/Math.pow(1024,c);d=-Math.floor(Math.log(n)/
Math.LN10);e=a.tickDecimals;null!=e&&d>e&&(d=e);var p=Math.pow(10,-d),n=n/p,h;1.5>n?h=1:3>n?(h=2,2.25<n&&(null==e||d+1<=e)&&(h=2.5,++d)):h=7.5>n?5:10;h=h*p*Math.pow(1024,c);null!=a.minTickSize&&h<a.minTickSize&&(h=a.minTickSize);a.delta=b;a.tickDecimals=Math.max(0,null!=e?e:d);a.tickSize=h;b=[];c=a.tickSize*Math.floor(a.min/a.tickSize);d=0;e=Number.NaN;do p=e,e=c+d*a.tickSize,b.push(e),++d;while(e<a.max&&e!=p);return b},min:0}},xaxes:{time:{name:"time",mode:"time",timezone:"browser",ticks:5}}},draggable:function(a){a.attr("draggable",
!0);a.on("dragstart",function(a){$(this).css("opacity",.4).data("dragstart",{click:{x:a.originalEvent.pageX,y:a.originalEvent.pageY},ele:{x:this.offsetLeft,y:this.offsetTop}})}).on("dragend",function(a){var c=$(this).data("dragstart"),d=c.ele.x-c.click.x+a.originalEvent.pageX;a=c.ele.y-c.click.y+a.originalEvent.pageY;$(this).css({opacity:1,top:a,left:d,right:"auto",bottom:"auto"})});a.parent().on("dragleave",function(){})},format:{time:function(a,b){var c=new Date(1E3*a),d=[];d.push(("0"+c.getHours()).slice(-2));
d.push(("0"+c.getMinutes()).slice(-2));"short"!=b&&d.push(("0"+c.getSeconds()).slice(-2));return d.join(":")},date:function(a,b){var c=new Date(1E3*a),d="Sun Mon Tue Wed Thu Fri Sat".split(" "),e=[];"long"==b&&e.push(d[c.getDay()]);e.push(("0"+c.getDate()).slice(-2));e.push("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[c.getMonth()]);"short"!=b&&e.push(c.getFullYear());return e.join(" ")},dateTime:function(a,b){return UI.format.date(a,b)+", "+UI.format.time(a,b)},duration:function(a){var b=
[.001,1E3,60,60,24,7,52,1E9],c="ms sec min hr day week year".split(" "),d={},e;for(e in c){a/=b[e];var n=Math.round(a%b[Number(e)+1]);d[c[e]]=n;a-=n}var p;for(e=c.length-1;0<=e;e--)if(0<d[c[e]]){p=c[e];break}b=$("<span>");switch(p){case "year":b.append(UI.format.addUnit(d.year,"years, ")).append(UI.format.addUnit(d.week,"wks"));break;case "week":b.append(UI.format.addUnit(d.week,"wks, ")).append(UI.format.addUnit(d.day,"days"));break;case "day":b.append(UI.format.addUnit(d.day,"days, ")).append(UI.format.addUnit(d.hr,
"hrs"));break;default:b.append([("0"+d.hr).slice(-2),("0"+d.min).slice(-2),("0"+d.sec).slice(-2)+(d.ms?"."+d.ms:"")].join(":"))}return b[0].innerHTML},number:function(a){if(isNaN(Number(a))||0==a)return a;var b=Math.pow(10,3-Math.floor(Math.log(a)/Math.LN10)-1);a=Math.round(a*b)/b;if(1E4<=a){number=a.toString().split(".");for(a=/(\d+)(\d{3})/;a.test(number[0]);)number[0]=number[0].replace(a,"$1 $2");a=number.join(".")}return a},status:function(a){var b=$("<div>");if("undefined"==typeof a.online)return b.text("Unknown, checking.."),
"undefined"!=typeof a.error&&b.addClass("status "+a.error),b;switch(a.online){case -1:b.addClass("status enabling");break;case 0:b.addClass("status unavailable");break;case 1:b.addClass("status active");break;case 2:b.addClass("status available");break;default:b.addClass("status standby")}"error"in a&&b.addClass("status "+a.error);return b},capital:function(a){return a.charAt(0).toUpperCase()+a.substring(1)},addUnit:function(a,b){var c=$("<span>").html(a);c.append($("<span>").addClass("unit").html(b));
return c[0].innerHTML},bytes:function(a,b){var c="bytes KiB MiB GiB TiB PiB".split(" ");if(0==a)unit=c[0];else{var d=Math.floor(Math.log(Math.abs(a))/Math.log(1024));0>d?unit=c[0]:(a/=Math.pow(1024,d),unit=c[d])}return UI.format.addUnit(UI.format.number(a),unit+(b?"/s":""))}},navto:function(a,b){var c=location.hash,d=c.split("@");d[0]=[mist.user.name,mist.user.host].join("&");d[1]=[a,b].join("&");"undefined"!=typeof screenlog&&screenlog.navto(d[1]);location.hash=d.join("@");location.hash==c&&$(window).trigger("hashchange")},
showTab:function(a,b){var c=UI.elements.main;if(mist.user.loggedin){if(!("ui_settings"in mist.data)){c.html("Loading..");mist.send(function(){UI.showTab(a,b)},{ui_settings:!0});return}mist.data.config.serverid&&(document.title=mist.data.config.serverid+" - MistServer MI")}var d=UI.elements.menu.removeClass("hide").find('.plain:contains("'+a+'")').closest(".button");0<d.length&&(UI.elements.menu.find(".button.active").removeClass("active"),d.addClass("active"));MistVideoObject&&MistVideoObject.reference&&
MistVideoObject.reference.unload();UI.interval.clear();c.html($("<h2>").text(a));switch(a){case "Login":if(mist.user.loggedin){UI.navto("Overview");return}c.append(UI.buildUI([{type:"help",help:"Please provide your account details.<br>You were asked to set these when MistController was started for the first time. If you did not yet set any account details, log in with your desired credentials to create a new account."},{label:"Host",help:"Url location of the MistServer API. Generally located at http://MistServerIP:4242/api",
default:"http://localhost:4242/api",pointer:{main:mist.user,index:"host"}},{label:"Username",help:"Please enter your username here.",validate:["required"],pointer:{main:mist.user,index:"name"}},{label:"Password",type:"password",help:"Please enter your password here.",validate:["required"],pointer:{main:mist.user,index:"rawpassword"}},{type:"buttons",buttons:[{label:"Login",type:"save",function:function(){mist.user.password=MD5(mist.user.rawpassword);delete mist.user.rawpassword;mist.send(function(){UI.navto("Overview")})}}]}]));
break;case "Create a new account":UI.elements.menu.addClass("hide");c.append($("<p>").text("No account has been created yet in the MistServer at ").append($("<i>").text(mist.user.host)).append("."));c.append(UI.buildUI([{type:"buttons",buttons:[{label:"Select other host",type:"cancel",css:{float:"left"},function:function(){UI.navto("Login")}}]},{type:"custom",custom:$("<br>")},{label:"Desired username",type:"str",validate:["required"],help:"Enter your desired username. In the future, you will need this to access the Management Interface.",
pointer:{main:mist.user,index:"name"}},{label:"Desired password",type:"password",validate:["required",function(a,b){$(".match_password.field").not($(b)).trigger("change");return!1}],help:"Enter your desired password. In the future, you will need this to access the Management Interface.",pointer:{main:mist.user,index:"rawpassword"},classes:["match_password"]},{label:"Repeat password",type:"password",validate:["required",function(a,b){return a!=$(".match_password.field").not($(b)).val()?{msg:'The fields "Desired password" and "Repeat password" do not match.',
classes:["red"]}:!1}],help:"Repeat your desired password.",classes:["match_password"]},{type:"buttons",buttons:[{type:"save",label:"Create new account",function:function(){mist.send(function(){UI.navto("Account created")},{authorize:{new_username:mist.user.name,new_password:mist.user.rawpassword}});mist.user.password=MD5(mist.user.rawpassword);delete mist.user.rawpassword}}]}]));break;case "Account created":UI.elements.menu.addClass("hide");c.append($("<p>").text("Your account has been created succesfully.")).append(UI.buildUI([{type:"text",
text:"Would you like to enable all (currently) available protocols with their default settings?"},{type:"buttons",buttons:[{label:"Enable protocols",type:"save",function:function(){mist.data.config.protocols?c.append("Unable to enable all protocols as protocol settings already exist.<br>"):(c.append("Retrieving available protocols..<br>"),mist.send(function(a){var b=[],d;for(d in a.capabilities.connectors)a.capabilities.connectors[d].required?c.append('Could not enable protocol "'+d+'" because it has required settings.<br>'):
(b.push({connector:d}),c.append('Enabled protocol "'+d+'".<br>'));c.append("Saving protocol settings..<br>");mist.send(function(a){c.append("Protocols enabled. Redirecting..");setTimeout(function(){UI.navto("Overview")},5E3)},{config:{protocols:b}})},{capabilities:!0}))}},{label:"Skip",type:"cancel",function:function(){UI.navto("Overview")}}]}]));break;case "Overview":var e=function(){h.text("active_streams"in mist.data?mist.data.active_streams?mist.data.active_streams.length:0:"?");if("totals"in
mist.data&&"all_streams"in mist.data.totals)var a=mist.data.totals.all_streams.all_protocols.clients,a=a.length?UI.format.number(a[a.length-1][1]):0;else a="Loading..";w.text(a);k.text(UI.format.dateTime(mist.data.config.time,"long"));u.html("");a=0;"license"in mist.data.config&&"user_msg"in mist.data.config.license&&mist.data.log.unshift([mist.data.config.license.time,"ERROR",mist.data.config.license.user_msg]);for(var b in mist.data.log){var c=mist.data.log[b];if(-1<["FAIL","ERROR"].indexOf(c[1])){a++;
var d=$("<span>").addClass("content").addClass("red"),e=c[2].split("|");for(b in e)d.append($("<span>").text(e[b]));u.append($("<div>").append($("<span>").append(UI.format.time(c[0]))).append(d));if(5==a)break}}0==a&&u.html("None.");a=[];c=[];for(b in mist.data.config.protocols)d=mist.data.config.protocols[b],-1<a.indexOf(d.connector)||a.push(d.connector);l.text(a.length?a.join(", "):"None.");if("capabilities"in mist.data){for(b in mist.data.capabilities.connectors)-1==a.indexOf(b)&&c.push(b);g.text(c.length?
c.join(", "):"None.")}else g.text("Loading..")},n=function(){var a={totals:{fields:["clients"],start:-10},active_streams:!0};"cabailities"in mist.data||(a.capabilities=!0);mist.send(function(a){e()},a)};if("undefined"==typeof mist.data.bandwidth){mist.send(function(b){UI.navto(a)},{bandwidth:!0});c.append("Loading..");return}var p=$("<span>").text("Loading.."),h=$("<span>"),u=$("<span>").addClass("logs"),w=$("<span>"),k=$("<span>"),A=$("<span>").text("Unknown"),l=$("<span>"),g=$("<span>"),f={serverid:mist.data.config.serverid,
debug:mist.data.config.debug,accesslog:mist.data.config.accesslog,prometheus:mist.data.config.prometheus,defaultStream:mist.data.config.defaultStream,trustedproxy:mist.data.config.trustedproxy,location:"location"in mist.data.config?mist.data.config.location:{}},m={};"bandwidth"in mist.data&&(m=mist.data.bandwidth,null==m&&(m={}),m.limit||(m.limit=""));var T=$("<select>").html($("<option>").val(1).text("bytes/s")).append($("<option>").val(1024).text("KiB/s")).append($("<option>").val(1048576).text("MiB/s")).append($("<option>").val(1073741824).text("GiB/s")),
J=parseURL(mist.user.host),J=J.protocol+J.host+J.port;c.append(UI.buildUI([{type:"help",help:"You can find most basic information about your MistServer here.<br>You can also set the debug level and force a save to the config.json file that MistServer uses to save your settings. "},{type:"span",label:"Version",pointer:{main:mist.data.config,index:"version"}},{type:"span",label:"Version check",value:p,LTSonly:!0},{type:"span",label:"Server time",value:k},{type:"span",label:"Licensed to",value:"license"in
mist.data.config?mist.data.config.license.user:"",LTSonly:!0},{type:"span",label:"Active licenses",value:A,LTSonly:!0},{type:"span",label:"Configured streams",value:mist.data.streams?Object.keys(mist.data.streams).length:0},{type:"span",label:"Active streams",value:h},{type:"span",label:"Current connections",value:w},{type:"span",label:"Enabled protocols",value:l},{type:"span",label:"Disabled protocols",value:g},{type:"span",label:"Recent problems",value:u},$("<br>"),{type:"str",label:"Human readable name",
pointer:{main:f,index:"serverid"},help:"You can name your MistServer here for personal use. You'll still need to set host name within your network yourself."},{type:"debug",label:"Debug level",pointer:{main:f,index:"debug"},help:"You can set the amount of debug information MistServer saves in the log. A full reboot of MistServer is required before some components of MistServer can post debug information."},{type:"selectinput",label:"Access log",selectinput:[["","Do not track"],["LOG","Log to MistServer log"],
[{type:"str",label:"Path",LTSonly:!0},"Log to file"]],pointer:{main:f,index:"accesslog"},help:"Enable access logs.",LTSonly:!0},{type:"selectinput",label:"Prometheus stats output",selectinput:[["","Disabled"],[{type:"str",label:"Passphrase",LTSonly:!0},"Enabled"]],pointer:{main:f,index:"prometheus"},help:"Make stats available in Prometheus format. These can be accessed via "+J+"/PASSPHRASE or "+J+"/PASSPHRASE.json.",LTSonly:!0},{type:"inputlist",label:"Trusted proxies",help:"List of proxy server addresses that are allowed to override the viewer IP address to arbitrary values.<br>You may use a hostname or IP address.",
LTSonly:!0,pointer:{main:f,index:"trustedproxy"}},{type:"selectinput",label:"Load balancer bandwidth limit",selectinput:[["","Default (1 gbps)"],[{label:"Custom",type:"int",min:0,unit:T},"Custom"]],pointer:{main:m,index:"limit"},help:"This setting only applies when MistServer is combined with a load balancer. This is the amount of traffic this server is willing to handle.",LTSonly:!0},{type:"inputlist",label:"Load balancer bandwidth exceptions",pointer:{main:m,index:"exceptions"},help:"This setting only applies when MistServer is combined with a load balancer. Data sent to the hosts and subnets listed here will not count towards reported bandwidth usage.<br>Examples:<ul><li>192.168.0.0/16</li><li>localhost</li><li>10.0.0.0/8</li><li>fe80::/16</li></ul>",
LTSonly:!0},{type:"int",step:1E-8,label:"Server latitude",pointer:{main:f.location,index:"lat"},help:"This setting is only useful when MistServer is combined with a load balancer. When this is set, the balancer can send users to a server close to them.",LTSonly:!0},{type:"int",step:1E-8,label:"Server longitude",pointer:{main:f.location,index:"lon"},help:"This setting is only useful when MistServer is combined with a load balancer. When this is set, the balancer can send users to a server close to them.",
LTSonly:!0},{type:"str",label:"Server location name",pointer:{main:f.location,index:"name"},help:"This setting is only useful when MistServer is combined with a load balancer. This will be displayed as the server's location.",LTSonly:!0},{type:"str",validate:["streamname_with_wildcard_and_variables"],label:"Fallback stream",pointer:{main:f,index:"defaultStream"},help:"When this is set, if someone attempts to view a stream that does not exist, or is offline, they will be redirected to this stream instead. $stream may be used to refer to the original stream name.",
LTSonly:!0},{type:"checkbox",label:"Force configurations save",pointer:{main:f,index:"save"},help:"Tick the box in order to force an immediate save to the config.json MistServer uses to save your settings. Saving will otherwise happen upon closing MistServer. Don't forget to press save after ticking the box."},{type:"buttons",buttons:[{type:"save",label:"Save",function:function(){var a={config:f},b={};b.limit=m.limit?T.val()*m.limit:0;b.exceptions=m.exceptions;null===b.exceptions&&(b.exceptions=[]);
a.bandwidth=b;f.save&&(a.save=f.save);delete f.save;mist.send(function(){UI.navto("Overview")},a)}}]}]));if(mist.data.LTS){var Ea=function(a){function b(a){if(a.update){var d="";"progress"in a.update&&(d=" ("+a.update.progress+"%)");p.text("Updating.."+d);c(a.log);setTimeout(function(){mist.send(function(a){b(a)},{update:!0})},1E3)}else UI.showTab("Overview")}function c(a){a=a.filter(function(a){return"UPDR"==a[1]});if(a.length){var b=$("<div>");p.append(b);for(var d in a)b.append($("<div>").text(a[d][2]))}}
if(a.update&&"uptodate"in a.update)if(a.update.error)p.addClass("red").text(a.update.error);else if(a.update.uptodate)p.text("Your version is up to date.").addClass("green");else{if(a.update.progress)p.addClass("orange").removeClass("red").text("Updating.."),b(a);else{p.text("");p.append($("<span>").addClass("red").text("On "+(new Date(a.update.date)).toLocaleDateString()+" version "+a.update.version+" became available."));a.update.url&&".zip"==a.update.url.slice(-4)||p.append($("<button>").text("Rolling update").css({"font-size":"1em",
"margin-left":"1em"}).click(function(){confirm("Are you sure you want to execute a rolling update?")&&(p.addClass("orange").removeClass("red").text("Rolling update command sent.."),mist.send(function(a){b(a)},{autoupdate:!0}))}));var d=$("<a>").attr("href",a.update.url).attr("target","_blank").text("Manual download");d[0].protocol="https:";p.append($("<div>").append(d))}c(a.log)}else p.text("Unknown, checking.."),setTimeout(function(){mist.send(function(a){"update"in a&&Ea(a)},{checkupdate:!0})},
5E3)};Ea(mist.data);if("license"in mist.data.config){if("active_products"in mist.data.config.license&&Object.keys(mist.data.config.license.active_products).length){var U=$("<table>").css("text-indent","0");A.html(U);U.append($("<tr>").append($("<th>").append("Product")).append($("<th>").append("Updates until")).append($("<th>").append("Use until")).append($("<th>").append("Max. simul. instances")));for(var t in mist.data.config.license.active_products){var M=mist.data.config.license.active_products[t];
U.append($("<tr>").append($("<td>").append(M.name)).append($("<td>").append(M.updates_final?M.updates_final:"&infin;")).append($("<td>").append(M.use_final?M.use_final:"&infin;")).append($("<td>").append(M.amount?M.amount:"&infin;")))}}else A.text("None. ");A.append($("<a>").text("More details").attr("href","https://shop.mistserver.org/myinvoices").attr("target","_blank"))}}else p.text("");n();e();UI.interval.set(n,3E4);break;case "Protocols":var Fa=function(){function a(b){var c=mist.data.capabilities.connectors[b.connector];
if(!c)return"";var d=[],e=["required","optional"],z;for(z in e)for(var f in c[e[z]])b[f]&&""!=b[f]?d.push(f+": "+b[f]):c[e[z]][f]["default"]&&d.push(f+": "+c[e[z]][f]["default"]);return $("<span>").addClass("description").text(d.join(", "))}G.html("");for(var b in mist.data.config.protocols){var c=mist.data.config.protocols[b],d=mist.data.capabilities.connectors[c.connector];G.append($("<tr>").data("index",b).append($("<td>").text(d&&d.friendly?d.friendly:c.connector)).append($("<td>").html(UI.format.status(c))).append($("<td>").html(a(c))).append($("<td>").css("text-align",
"right").html($("<button>").text("Edit").click(function(){UI.navto("Edit Protocol",$(this).closest("tr").data("index"))})).append($("<button>").text("Delete").click(function(){var a=$(this).closest("tr").data("index");confirm('Are you sure you want to delete the protocol "'+mist.data.config.protocols[a].connector+'"?')&&(mist.send(function(a){UI.navto("Protocols")},{deleteprotocol:mist.data.config.protocols[a]}),mist.data.config.protocols.splice(a,1))}))))}};if("undefined"==typeof mist.data.capabilities){mist.send(function(b){UI.navto(a)},
{capabilities:!0});c.append("Loading..");return}var G=$("<tbody>");c.append(UI.buildUI([{type:"help",help:"You can find an overview of all the protocols and their relevant information here. You can add, edit or delete protocols."}])).append($("<button>").text("Delete all protocols").click(function(){confirm("Are you sure you want to delete all currently configured protocols?")&&(mist.data.config.protocols=[],mist.send(function(a){UI.navto("Protocols")},{config:mist.data.config}))})).append($("<button>").text("Enable default protocols").click(function(){var a=
Object.keys(mist.data.capabilities.connectors),b;for(b in mist.data.config.protocols){var c=a.indexOf(mist.data.config.protocols[b].connector);-1<c&&a.splice(c,1)}var d=[];for(b in a)"required"in mist.data.capabilities.connectors[a[b]]&&0!=Object.keys(mist.data.capabilities.connectors[a[b]].required).length||d.push(a[b]);c="Click OK to enable disabled protocols with their default settings:\n  ";c=d.length?c+d.join(", "):c+"None.";d.length!=a.length&&(a=a.filter(function(a){return 0>d.indexOf(a)}),
c+="\n\nThe following protocols can only be set manually:\n  "+a.join(", "));if(confirm(c)&&d.length){null===mist.data.config.protocols&&(mist.data.config.protocols=[]);for(b in d)mist.data.config.protocols.push({connector:d[b]});mist.send(function(a){UI.navto("Protocols")},{config:mist.data.config})}})).append("<br>").append($("<button>").text("New protocol").click(function(){UI.navto("Edit Protocol")}).css("clear","both")).append($("<table>").html($("<thead>").html($("<tr>").html($("<th>").text("Protocol")).append($("<th>").text("Status")).append($("<th>").text("Settings")).append($("<th>")))).append(G));
Fa();UI.interval.set(function(){mist.send(function(){Fa()})},1E4);break;case "Edit Protocol":var Ga=function(a){var b=mist.data.capabilities.connectors[a],c=mist.convertBuildOptions(b,q);if(N)var d=$.extend({},q);c.push({type:"hidden",pointer:{main:q,index:"connector"},value:a});c.push({type:"buttons",buttons:[{type:"save",label:"Save",function:function(){var a={};N?a.updateprotocol=[d,q]:a.addprotocol=q;mist.send(function(a){UI.navto("Protocols")},a)}},{type:"cancel",label:"Cancel",function:function(){UI.navto("Protocols")}}]});
if("deps"in b&&""!=b.deps){U=$("<span>").text("Dependencies:");$ul=$("<ul>");U.append($ul);"string"==typeof b.deps&&(b.deps=b.deps.split(", "));for(var e in b.deps)a=$("<li>").text(b.deps[e]+" "),$ul.append(a),"undefined"!=typeof Y[b.deps[e]]||"undefined"!=typeof Y[b.deps[e]+".exe"]?a.append($("<span>").addClass("green").text("(Configured)")):a.append($("<span>").addClass("red").text("(Not yet configured)"));c.unshift({type:"text",text:U[0].innerHTML})}return UI.buildUI(c)};if("undefined"==typeof mist.data.capabilities){mist.send(function(c){UI.navto(a,
b)},{capabilities:!0});c.append("Loading..");return}var N=!1;""!=b&&0<=b&&(N=!0);var Y={};for(t in mist.data.config.protocols)Y[mist.data.config.protocols[t].connector]=1;Y={};for(t in mist.data.config.protocols)Y[mist.data.config.protocols[t].connector]=1;if(N){var v=mist.data.config.protocols[b],q=v;c.find("h2").append(' "'+v.connector+'"');c.append(Ga(v.connector))}else{c.html($("<h2>").text("New Protocol"));var q={},x=[["",""]];for(t in mist.data.capabilities.connectors)x.push([t,mist.data.capabilities.connectors[t].friendly?
mist.data.capabilities.connectors[t].friendly:t]);var V=$("<span>");c.append(UI.buildUI([{label:"Protocol",type:"select",select:x,function:function(){""!=$(this).getval()&&V.html(Ga($(this).getval()))}}])).append(V)}break;case "Streams":var pa=function(b,d,e){O.remove();switch(b){case "thumbnails":var f=$("<div>").addClass("preview_icons");(function(b,d){d=d||[];b.sort();b.unshift("");O.remove();c.append($("<h2>").text(a)).append(UI.buildUI([{label:"Filter the streams",type:"datalist",datalist:b,
pointer:{main:{},index:"stream"},help:"If you type something here, the box below will only show streams with names that contain your text.",function:function(){var a=$(this).val();f.children().each(function(){$(this).hide();-1<$(this).attr("data-stream").indexOf(a)&&$(this).show()})}}]));b.shift();c.append($("<span>").addClass("description").text("Choose a stream below.")).append(f);for(var e in b){var g=b[e],z="",h=$("<button>").text("Delete").click(function(){var a=$(this).closest("div").attr("data-stream");
if(confirm('Are you sure you want to delete the stream "'+a+'"?')){delete mist.data.streams[a];var b={};b.deletestream=[a];mist.send(function(a){UI.navto("Streams")},b)}}),l=$("<button>").text("Settings").click(function(){UI.navto("Edit",$(this).closest("div").attr("data-stream"))}),Ha=$("<button>").text("Preview").click(function(){UI.navto("Preview",$(this).closest("div").attr("data-stream"))}),m=$("<button>").text("Embed").click(function(){UI.navto("Embed",$(this).closest("div").attr("data-stream"))}),
k=$("<span>").addClass("image");-1<g.indexOf("+")?(z=g.split("+"),z=mist.data.streams[z[0]].source+z[1],l=h="",k.addClass("wildcard")):(z=mist.data.streams[g].source,-1<d.indexOf(g)&&(m=Ha="",k.addClass("folder")));f.append($("<div>").append($("<span>").addClass("streamname").text(g)).append(k).append($("<span>").addClass("description").text(z)).append($("<span>").addClass("button_container").append(l).append(h).append(Ha).append(m)).attr("title",g).attr("data-stream",g))}})(d,e);break;default:var g=
function(){var a=[],b;for(b in mist.data.active_streams)a.push({streams:[mist.data.active_streams[b]],fields:["clients"],start:-2});mist.send(function(){$.extend(!0,E,mist.data.streams);h()},{totals:a,active_streams:!0})},h=function(){var a=0;l.html("");d.sort();for(var b in d){var c=d[b],e;e=c in mist.data.streams?mist.data.streams[c]:E[c];var f=$("<td>").css("text-align","left").html($("<span>").addClass("description").text("Loading..")),g=0;if("undefined"!=typeof mist.data.totals&&"undefined"!=
typeof mist.data.totals[c]){var z=mist.data.totals[c].all_protocols.clients,g=0;if(z.length){for(a in z)g+=z[a][1];g=Math.round(g/z.length)}}f.html(UI.format.number(g));0==g&&1==e.online&&(e.online=2);g=$("<td>").css("text-align","left").css("white-space","nowrap");"ischild"in e&&e.ischild||g.html($("<button>").text("Settings").click(function(){UI.navto("Edit",$(this).closest("tr").data("index"))}));g=$("<span>").text(e.name);e.ischild&&g.css("padding-left","1em");var z=UI.format.status(e),h=$("<button>").text("Preview").click(function(){UI.navto("Preview",
$(this).closest("tr").data("index"))});if("filesfound"in E[c]||0>e.online)z.html(""),h="",f.html(""),$embed="";l.append($("<tr>").data("index",c).html($("<td>").html(g).attr("title","..."==e.name?"The results were truncated":e.name).addClass("overflow_ellipsis")).append($("<td>").data("sort-value",e.online).html(z)).append(f).append($("<td>").css("white-space","nowrap").html(h)));a++}},l=$("<tbody>").append($("<tr>").append("<td>").attr("colspan",6).text("Loading.."));b=$("<table>").html($("<thead>").html($("<tr>").html($("<th>").css("width",
"40%").text("Stream name").attr("data-sort-type","string").addClass("sorting-asc")).append($("<th>").css("width","40%").text("Status").attr("data-sort-type","int")).append($("<th>").css("text-align","left").text("Connections").attr("data-sort-type","int")).append($("<th>")))).append(l);c.append(b);b.stupidtable();if(mist.data.LTS){var m=0,k=0,n;for(n in mist.data.streams){b=mist.data.capabilities.inputs.Folder||mist.data.capabilities.inputs["Folder.exe"];if(!b)break;mist.inputMatch(b.source_match,
mist.data.streams[n].source)&&(E[n].source+="*",E[n].filesfound=null,mist.send(function(a,b){var c=b.stream,d=0,e;a:for(e in a.browse.files){var f;for(f in mist.data.capabilities.inputs)if(!(0<=f.indexOf("Buffer")||0<=f.indexOf("Buffer.exe")||0<=f.indexOf("Folder")||0<=f.indexOf("Folder.exe"))&&mist.inputMatch(mist.data.capabilities.inputs[f].source_match,"/"+a.browse.files[e])){var z=c+"+"+a.browse.files[e];E[z]=qa(z,mist.data.streams[c]);E[z].source=mist.data.streams[c].source+a.browse.files[e];
d++;if(500<=d){E[c+"+zzzzzzzzz"]={ischild:!0,name:"...",online:-1};break a}}}"files"in a.browse&&a.browse.files.length?E[c].filesfound=!0:mist.data.streams[c].filesfound=!1;k++;m==k&&(mist.send(function(){g()},{active_streams:!0}),UI.interval.set(function(){g()},5E3))},{browse:mist.data.streams[n].source},{stream:n}),m++)}0==m&&(mist.send(function(){g()},{active_streams:!0}),UI.interval.set(function(){g()},5E3))}else mist.send(function(){g()},{active_streams:!0}),UI.interval.set(function(){g()},5E3)}},
qa=function(a,b){var c=$.extend({},b);delete c.meta;delete c.error;c.online=2;c.name=a;c.ischild=!0;return c};document.title="Streams: Livepeer Project Aqueduct";UI.elements.header_title.text("Streams");if(!("capabilities"in mist.data)){c.html("Loading..");mist.send(function(){UI.navto(a)},{capabilities:!0});return}var eb=$("<button>"),O=$("<span>").text("Loading..");c.append(UI.buildUI([{type:"help",help:"Here is a place for some helper text about streams."}])).append(O);""==b&&(f=mist.stored.get(),
"viewmode"in f&&(b=f.viewmode));eb.text("Switch to "+("thumbnails"==b?"list":"thumbnail")+" view").click(function(){mist.stored.set("viewmode","thumbnails"==b?"list":"thumbnails");UI.navto("Streams","thumbnails"==b?"list":"thumbnails")});var E=$.extend(!0,{},mist.data.streams);if(mist.data.LTS){var ra=0,Ia=0,x={},Ja=[];for(f in mist.data.streams)mist.inputMatch((mist.data.capabilities.inputs.Folder||mist.data.capabilities.inputs["Folder.exe"]).source_match,mist.data.streams[f].source)&&(Ja.push(f),
mist.send(function(a,c){var d=c.stream,e=0,f;a:for(f in a.browse.files){var g;for(g in mist.data.capabilities.inputs)if(!(0<=g.indexOf("Buffer")||0<=g.indexOf("Folder"))&&mist.inputMatch(mist.data.capabilities.inputs[g].source_match,"/"+a.browse.files[f])&&(x[d+"+"+a.browse.files[f]]=!0,e++,500<=e)){x[d+"+zzzzzzzzz"]=!0;break a}}Ia++;ra==Ia&&mist.send(function(){for(var a in mist.data.active_streams){var c=mist.data.active_streams[a].split("+");1<c.length&&c[0]in mist.data.streams&&(x[mist.data.active_streams[a]]=
!0,E[mist.data.active_streams[a]]=qa(mist.data.active_streams[a],mist.data.streams[c[0]]))}x=Object.keys(x);x=x.concat(Object.keys(mist.data.streams));x.sort();pa(b,x,Ja)},{active_streams:!0})},{browse:mist.data.streams[f].source},{stream:f}),ra++);0==ra&&mist.send(function(){for(var a in mist.data.active_streams){var c=mist.data.active_streams[a].split("+");1<c.length&&c[0]in mist.data.streams&&(x[mist.data.active_streams[a]]=!0,E[mist.data.active_streams[a]]=qa(mist.data.active_streams[a],mist.data.streams[c[0]]))}x=
Object.keys(x);mist.data.streams&&(x=x.concat(Object.keys(mist.data.streams)));x.sort();pa(b,x)},{active_streams:!0})}else pa(b,Object.keys(mist.data.streams));break;case "Edit":var sa=function(){var a=c.find("[name=name]").val();if(a){var b=parseURL(mist.user.host),d=c.find("[name=source]").val(),e=d.match(/@.*/);e&&(e=e[0].substring(1));var f=d.replace(/(?:.+?):\/\//,""),f=f.split("/"),f=f[0],f=f.split(":"),f=f[0];(d=d.match(/:\d+/))&&(d=d[0]);var g={},h=["RTMP","RTSP","RTMP.exe","RTSP.exe"],l;
for(l in h)h[l]in mist.data.capabilities.connectors&&(g[h[l]]=mist.data.capabilities.connectors[h[l]].optional.port["default"]);var h={RTMP:1935,"RTMP.exe":1935,RTSP:554,"RTSP.exe":554,TS:-1,"TS.exe":-1},m;for(m in g){for(l in mist.data.config.protocols){var k=mist.data.config.protocols[l];if(k.connector==m){"port"in k&&(g[m]=k.port);break}}g[m]=g[m]==h[m]?"":":"+g[m]}g.TS="";g["TS.exe"]="";Q.find(".field").closest("label").hide();for(l in g){var P;m=d?d:g[l];switch(l){case "RTMP":case "RTMP.exe":P=
"rtmp://"+b.host+m+"/"+(e?e:"live")+"/";Q.find(".field.RTMPurl").setval(P).closest("label").show();Q.find(".field.RTMPkey").setval(""==a?"STREAMNAME":a).closest("label").show();P+=""==a?"STREAMNAME":a;break;case "RTSP":case "RTSP.exe":P="rtsp://"+b.host+m+"/"+(""==a?"STREAMNAME":a)+(e?"?pass="+e:"");break;case "TS":case "TS.exe":P="udp://"+(""==f?b.host:f)+m+"/"}Q.find(".field."+l.replace(".exe","")).setval(P).closest("label").show()}}},Ka=function(a){var c={};mist.data.streams||(mist.data.streams=
{});mist.data.streams[q.name]=q;b!=q.name&&delete mist.data.streams[b];c.addstream={};c.addstream[q.name]=q;b!=q.name&&(c.deletestream=[b]);q.stop_sessions&&""!=b&&(c.stop_sessions=b,delete q.stop_sessions);mist.send(function(){delete mist.data.streams[q.name].online;delete mist.data.streams[q.name].error;UI.navto(a,"Preview"==a?q.name:"")},c)};if("undefined"==typeof mist.data.capabilities){mist.send(function(c){UI.navto(a,b)},{capabilities:!0});c.append("Loading..");return}N=!1;""!=b&&(N=!0);if(N){var La=
b,q=mist.data.streams[La];c.find("h2").append(' "'+La+'"')}else c.html($("<h2>").text("New Stream")),q={};var Ma=[];for(t in mist.data.capabilities.inputs)Ma.push(mist.data.capabilities.inputs[t].source_match);var ia=$("<div>"),Na=$("<style>").text("button.saveandpreview { display: none; }"),Q=$("<span>"),Oa=$("<div>"),ta={},x=[],Pa=$("<div>");for(t in mist.data.capabilities.processes)x.push([t,mist.data.capabilities.processes[t].hrn?mist.data.capabilities.processes[t].hrn:mist.data.capabilities.processes[t].name]);
if(x.length){var fb=[{label:"New process",type:"select",select:x,value:x[0][0],pointer:{main:ta,index:"process"},function:function(){var a=$(this).getval();if(null!=a){var a=mist.data.capabilities.processes[a],b=[$("<h4>").text(a.name+" Process options")];Pa.html(UI.buildUI(b.concat(mist.convertBuildOptions(a,ta))))}}},Pa];Oa.append(UI.buildUI([$("<br>"),$("<h3>").text("Stream processes"),{label:"Stream processes",itemLabel:"stream process",type:"sublist",sublist:fb,saveas:ta,pointer:{main:q,index:"processes"}}]))}c.append(UI.buildUI([{label:"Stream name",
type:"str",validate:["required","streamname"],pointer:{main:q,index:"name"},help:"Set the name this stream will be recognised by for players and/or stream pushing."},{label:"Source",type:"browse",filetypes:Ma,pointer:{main:q,index:"source"},help:"<p>                    Below is the explanation of the input methods for MistServer. Anything between brackets () will go to default settings if not specified.                  </p>                  <table class=valigntop>                    <tr>                      <th colspan=3><b>File inputs</b></th>                    </tr>                    <tr>                      <th>File</th>                      <td>                        Linux/MacOS:&nbsp;/PATH/FILE<br>                        Windows:&nbsp;/cygdrive/DRIVE/PATH/FILE                      </td>                      <td>                        For file input please specify the proper path and file.<br>                        Supported inputs are: DTSC, FLV, MP3. MistServer Pro has TS, MP4, ISMV added as input.                      </td>                    </tr>                      <th>                        Folder                      </th>                      <td>                        Linux/MacOS:&nbsp;/PATH/<br>                        Windows:&nbsp;/cygdrive/DRIVE/PATH/                      </td>                      <td class=LTSonly>                        A folder stream makes all the recognised files in the selected folder available as a stream.                      </td>                    </tr>                    <tr><td colspan=3>&nbsp;</td></tr>                    <tr>                      <th colspan=3><b>Push inputs</b></th>                    </tr>                    <tr>                      <th>RTMP</th>                      <td>push://(IP)(@PASSWORD)</td>                      <td>                        IP is white listed IP for pushing towards MistServer, if left empty all are white listed.<br>                        PASSWORD is the application under which to push to MistServer, if it doesn't match the stream will be rejected. PASSWORD is MistServer Pro only.                      </td>                    </tr>                    <tr>                      <th>RTSP</th>                      <td>push://(IP)(@PASSWORD)</td>                      <td class=LTSonly>IP is white listed IP for pushing towards MistServer, if left empty all are white listed.</td>                    </tr>                    <tr>                      <th>TS</th>                      <td>tsudp://(IP):PORT(/INTERFACE)</td>                      <td class=LTSonly>                        IP is the IP address used to listen for this stream, multi-cast IP range is: 224.0.0.0 - 239.255.255.255. If IP is not set all addresses will listened to.<br>                        PORT is the port you reserve for this stream on the chosen IP.<br>                        INTERFACE is the interface used, if left all interfaces will be used.                      </td>                    </tr>                    <tr><td colspan=3>&nbsp;</td></tr>                    <tr>                      <th colspan=3><b>Pull inputs</b></th>                    </tr>                    <tr>                      <th>DTSC</th>                      <td>dtsc://MISTSERVER_IP:PORT/(STREAMNAME)</td>                      <td>MISTSERVER_IP is the IP of another MistServer to pull from.<br>                        PORT is the DTSC port of the other MistServer. (default is 4200)<br>                        STREAMNAME is the name of the target stream on the other MistServer. If left empty, the name of this stream will be used.                      </td>                    </tr>                    <tr>                      <th>HLS</th>                      <td>http://URL/TO/STREAM.m3u8</td>                      <td class=LTSonly>The URL where the HLS stream is available to MistServer.</td>                    </tr>                    <tr>                      <th>RTSP</th>                      <td>rtsp://(USER:PASSWORD@)IP(:PORT)(/path)</td>                      <td class=LTSonly>                        USER:PASSWORD is the account used if authorization is required.<br>                        IP is the IP address used to pull this stream from.<br>                        PORT is the port used to connect through.<br>                        PATH is the path to be used to identify the correct stream.                      </td>                    </tr>                  </table>".replace(/LTSonly/g,
mist.data.LTS?'""':"LTSonly"),function:function(){var a=$(this).val();Na.remove();Q.html("");if(""!=a){var b=null,d;for(d in mist.data.capabilities.inputs)if("undefined"!=typeof mist.data.capabilities.inputs[d].source_match&&mist.inputMatch(mist.data.capabilities.inputs[d].source_match,a)){b=d;break}if(null===b)ia.html($("<h3>").text("Unrecognized input").addClass("red")).append($("<span>").text("Please edit the stream source.").addClass("red"));else{b=mist.data.capabilities.inputs[b];ia.html($("<h3>").text(b.name+
" Input options"));var e=mist.convertBuildOptions(b,q);"always_match"in mist.data.capabilities.inputs[d]&&mist.inputMatch(mist.data.capabilities.inputs[d].always_match,a)&&e.push({label:"Always on",type:"checkbox",help:"Keep this input available at all times, even when there are no active viewers.",pointer:{main:q,index:"always_on"}});ia.append(UI.buildUI(e));if("Folder"==b.name)c.append(Na);else if(-1<["Buffer","Buffer.exe","TS","TS.exe"].indexOf(b.name)){d=[$("<br>"),$("<span>").text("Configure your source to push to:")];
switch(b.name){case "Buffer":case "Buffer.exe":d.push({label:"RTMP full url",type:"span",clipboard:!0,readonly:!0,classes:["RTMP"],help:"Use this RTMP url if your client doesn't ask for a stream key"});d.push({label:"RTMP url",type:"span",clipboard:!0,readonly:!0,classes:["RTMPurl"],help:"Use this RTMP url if your client also asks for a stream key"});d.push({label:"RTMP stream key",type:"span",clipboard:!0,readonly:!0,classes:["RTMPkey"],help:"Use this key if your client asks for a stream key"});
d.push({label:"RTSP",type:"span",clipboard:!0,readonly:!0,classes:["RTSP"]});break;case "TS":case "TS.exe":"/"==a.charAt(0)?d=[]:d.push({label:"TS",type:"span",clipboard:!0,readonly:!0,classes:["TS"]})}Q.html(UI.buildUI(d));sa()}}}}},{label:"Stop sessions",type:"checkbox",help:"When saving these stream settings, kill this stream's current connections.",LTSonly:!0,pointer:{main:q,index:"stop_sessions"}},Q,$("<br>"),{type:"custom",custom:ia},Oa,$("<br>"),$("<h3>").text("Encryption"),{type:"help",help:"To enable encryption, the licence acquisition url must be entered, as well as either the content key or the key ID and seed.<br>Unsure how you should fill in your encryption or missing your preferred encryption? Please contact us."},
{label:"License acquisition url",type:"str",LTSonly:!0,pointer:{main:q,index:"la_url"}},$("<br>"),{label:"Content key",type:"str",LTSonly:!0,pointer:{main:q,index:"contentkey"}},{type:"text",text:" - or - "},{label:"Key ID",type:"str",LTSonly:!0,pointer:{main:q,index:"keyid"}},{label:"Key seed",type:"str",LTSonly:!0,pointer:{main:q,index:"keyseed"}},{type:"buttons",buttons:[{type:"cancel",label:"Cancel",function:function(){UI.navto("Streams")}},{type:"save",label:"Save",function:function(){Ka("Streams")}},
{type:"save",label:"Save and Preview",function:function(){Ka("Preview")},classes:["saveandpreview"]}]}]));c.find("[name=name]").keyup(function(){sa()});sa();break;case "Preview":var gb=function(a){function b(a,c){return"maxbps"in a?UI.format.bytes(a[c],1):"maxbps"==c?UI.format.bytes(a.bps,1):"unknown"}var c=a.meta;if(c&&c.tracks){a=[];a.push({label:"Type",type:"span",value:c.live?"Live":"Pre-recorded (VoD)"});"format"in c&&a.push({label:"Format",type:"span",value:c.format});c.live&&a.push({label:"Buffer window",
type:"span",value:UI.format.addUnit(c.buffer_window,"ms")});var d={audio:{vheader:"Audio",labels:"Codec;Duration;Avg bitrate;Peak bitrate;Channels;Samplerate;Language;Track index".split(";"),content:[]},video:{vheader:"Video",labels:"Codec;Duration;Avg bitrate;Peak bitrate;Size;Framerate;Language;Track index;Has B-Frames".split(";"),content:[]},subtitle:{vheader:"Subtitles",labels:"Codec;Duration;Avg bitrate;Peak bitrate;Language;Track index".split(";"),content:[]}},e=Object.keys(c.tracks);e.sort(function(a,
b){a=a.split("_").pop();b=b.split("_").pop();return a-b});var f=1,g=1,h=1,l;for(l in e){var m=e[l],k=c.tracks[m];switch(k.type){case "audio":d.audio.content.push({header:"Track "+m.split("_").pop(),body:[k.codec,UI.format.duration((k.lastms-k.firstms)/1E3)+"<br><span class=description>"+UI.format.duration(k.firstms/1E3)+" to "+UI.format.duration(k.lastms/1E3)+"</span>",b(k,"bps"),b(k,"maxbps"),k.channels,UI.format.addUnit(UI.format.number(k.rate),"Hz"),"language"in k?k.language:"unknown",f]});f++;
break;case "video":d.video.content.push({header:"Track "+m.split("_").pop(),body:[k.codec,UI.format.duration((k.lastms-k.firstms)/1E3)+"<br><span class=description>"+UI.format.duration(k.firstms/1E3)+" to "+UI.format.duration(k.lastms/1E3)+"</span>",b(k,"bps"),b(k,"maxbps"),UI.format.addUnit(k.width,"x ")+UI.format.addUnit(k.height,"px"),UI.format.addUnit(UI.format.number(k.fpks/1E3),"fps"),"language"in k?k.language:"unknown",g,"bframes"in k?"yes":"no"]});g++;break;case "meta":case "subtitle":if("subtitle"==
k.codec||"subtitle"==k.type)d.subtitle.content.push({header:"Track "+m.split("_").pop(),body:[k.codec,UI.format.duration((k.lastms-k.firstms)/1E3)+"<br><span class=description>"+UI.format.duration(k.firstms/1E3)+" to "+UI.format.duration(k.lastms/1E3)+"</span>",b(k,"bps"),b(k,"maxbps"),"language"in k?k.language:"unknown",h]}),h++}}l=["audio","video","subtitle"];c=$("<div>").css({display:"flex","flex-flow":"row wrap","font-size":"0.9em"});for(m in l)d[l[m]].content.length&&c.append(UI.buildVheaderTable(d[l[m]]).css("width",
"auto"));a.push($("<span>").text("Tracks:"));a.push(c);ja.html(UI.buildUI(a))}else ja.html("No meta information available.")},Ra=function(){Qa.text("");var a=document.createElement("script");c.append(a);a.src=y+"player.js";a.onerror=function(){Z.html($("<p>").append('Failed to load <a href="'+y+'player.js">'+y+"player.js</a>.")).append($("<p>").append("Please check if you've activated the HTTP protocol, if your http port is blocked, or if you're trying to load HTTPS on an HTTP page.")).append($("<button>").text("Reload").css("display",
"block").click(function(){Ra()}))};a.onload=function(){hb(b);c[0].removeChild(a)};MistVideoObject.reference={unload:function(){a.onload=function(){this.parentElement&&this.parentElement.removeChild(this)}}}},hb=function(c){function d(){var a=MistVideoObject.reference;ua.html("");ua.append(a.UI.buildStructure({type:"container",classes:["mistvideo-column"],style:{flexShrink:1},children:[{if:function(){return this.playerName&&this.source},then:{type:"container",classes:["mistvideo-description"],style:{display:"block"},
children:[{type:"playername",style:{display:"inline"}},{type:"text",text:"is playing",style:{margin:"0 0.2em"}},{type:"mimetype"}]}},{type:"decodingIssues",style:{"max-width":"30em","flex-flow":"column nowrap"}},{type:"container",classes:["mistvideo-column","mistvideo-devcontrols"],children:[{type:"text",text:"Player control"},{type:"container",classes:["mistvideo-devbuttons"],style:{"flex-wrap":"wrap"},children:[{if:function(){return!(!this.player||!this.player.api)},then:{type:"button",title:"Reload the video source",
label:"Reload video",onclick:function(){this.player.api.load()}}},{type:"button",title:"Build MistVideo again",label:"Reload player",onclick:function(){this.reload()}},{type:"button",title:"Switch to the next available player and source combination",label:"Try next combination",onclick:function(){this.nextCombo()}}]},{type:"forcePlayer"},{type:"forceType"},{type:"forceSource"}]},{type:"log"}]}))}"Preview"==a&&b&&""!=b&&c==b&&(Z[0].addEventListener("initialized",d),Z[0].addEventListener("initializeFailed",
d),MistVideoObject.reference=mistPlay(c,{target:Z[0],host:y,skin:"dev",loop:!0,MistVideoObject:MistVideoObject}))};""==b&&UI.navto("Streams");var R=parseURL(mist.user.host),aa=R.protocol,W=R.host,K=":8080",y=aa+W+K+"/";for(t in mist.data.config.protocols)if(v=mist.data.config.protocols[t],"HTTP"==v.connector||"HTTP.exe"==v.connector){v.pubaddr&&v.pubaddr.length?"string"==typeof v.pubaddr?y=v.pubaddr.replace(/\/$/,"")+"/":v.pubaddr.length&&(y=v.pubaddr[0].replace(/\/$/,"")+"/"):(K=v.port?":"+v.port:
":8080",y=aa+W+K+"/");break}var V=$("<div>").css({display:"flex","flex-flow":"row wrap","flex-shrink":1,"min-width":"auto"}),ba="";-1==b.indexOf("+")&&(ba=$("<button>").text("Settings").addClass("settings").click(function(){UI.navto("Edit",b)}));c.html($("<div>").addClass("bigbuttons").append(ba).append($("<button>").text("Embed").addClass("embed").click(function(){UI.navto("Embed",b)})).append($("<button>").addClass("cancel").addClass("return").text("Return").click(function(){UI.navto("Streams")}))).append($("<h2>").text('Preview of "'+
b+'"')).append(V);var L=encodeURIComponent(b),Sa=$("<div>").css("flex-shrink","1").css("min-width","auto").css("max-width","100%");V.append(Sa);var Qa=$("<div>"),Z=$("<div>").text("Loading player..").css("max-width","100%").css("flex-shrink","1").css("min-width","auto"),ua=$("<div>").addClass("controls");Sa.append(Z).append(Qa).append(ua);$("link#devcss").length||c.append($("<link>").attr("rel","stylesheet").attr("type","text/css").attr("href",y+"skins/dev.css").attr("id","devcss"));Ra();var va=$("<div>").append($("<h3>").text("Meta information")),
ja=$("<span>").text("Loading..");va.append(ja);var Ta=$("<div>").addClass("process_info");va.append(Ta);V.append(va);if(""!=L){var Ua=function(){var a={proc_list:b};mist.data.capabilities||(a.capabilities=!0);mist.send(function(a){if(a.proc_list){var b=$("<table>").css("width","auto"),c={"Process type:":function(a){return $("<b>").text(a.process)},"Source:":function(a){var b=$("<span>").text(a.source);a.source_tracks&&a.source_tracks.length&&b.append($("<span>").addClass("description").text(" track "+
a.source_tracks.slice(0,-2).concat(a.source_tracks.slice(-2).join(" and ")).join(", ")));return b},"Sink:":function(a){var b=$("<span>").text(a.sink);a.sink_tracks&&a.sink_tracks.length&&b.append($("<span>").addClass("description").text(" track "+a.sink_tracks.slice(0,-2).concat(a.sink_tracks.slice(-2).join(" and ")).join(", ")));return b},"Active for:":function(a){var b=(new Date).setSeconds((new Date).getSeconds()-a.active_seconds);return $("<span>").append($("<span>").text(UI.format.duration(a.active_seconds))).append($("<span>").addClass("description").text(" since "+
UI.format.time(b/1E3)))},"Pid:":function(a,b){return b},"Logs:":function(a){var b=$("<div>").text("None.");if(a.logs&&a.logs.length){b.html("").addClass("description").css({overflow:"auto",maxHeight:"6em",display:"flex",flexFlow:"column-reverse nowrap"});for(var c in a.logs){var d=a.logs[c];b.prepend($("<div>").append(UI.format.time(d[0])+" ["+d[1]+"] "+d[2]))}}return b},"Additional info:":function(a){var b;if(a.ainfo&&Object.keys(a.ainfo).length){b=$("<table>");for(var c in a.ainfo){var d=mist.data.capabilities.processes[a.process].ainfo[c];
d||(d={name:c});b.append($("<tr>").append($("<th>").text(d.name+":")).append($("<td>").html(a.ainfo[c]).append(d.unit?$("<span>").addClass("unit").text(d.unit):"")))}}else b=$("<span>").addClass("description").text("N/A");return b}};Ta.html($("<h4>").text("Stream processes")).append(b);for(var d in c){var e=$("<tr>");b.append(e);e.append($("<th>").text(d).css("vertical-align","top"));for(var f in a.proc_list)$out=c[d](a.proc_list[f],f),e.append($("<td>").html($out).css("vertical-align","top"))}}},
a)};$.ajax({type:"GET",url:y+"json_"+L+".js",success:function(a){gb(a)},error:function(){ja.html("Error while retrieving stream info.")}});UI.interval.set(function(){Ua()},5E3);Ua()}break;case "Embed":var C=function(){function a(b){switch(typeof b){case "string":return $.isNumeric(b)?b:'"'+b+'"';case "object":return JSON.stringify(b);default:return b}}ca&&UI.stored.saveOpt("embedoptions",r);var c=b+"_"+function(a){for(var b="";a--;){var c;c=Math.floor(62*Math.random());c=10>c?c:36>c?String.fromCharCode(c+
55):String.fromCharCode(c+61);b+=c}return b}(12),d=['target: document.getElementById("'+c+'")'],e;for(e in r)"prioritize_type"==e?r[e]&&""!=r[e]&&d.push("forcePriority: "+JSON.stringify({source:[["type",[r[e]]]]})):"monitor_action"==e?r[e]&&""!=r[e]&&"nextCombo"==r[e]&&d.push('monitor: {\n          action: function(){\n            this.MistVideo.log("Switching to nextCombo because of poor playback in "+this.MistVideo.source.type+" ("+Math.round(this.vars.score*1000)/10+"%)");\n            this.MistVideo.nextCombo();\n          }\n        }'):
r[e]==wa[e]||null==r[e]||"object"==typeof r[e]&&JSON.stringify(r[e])==JSON.stringify(wa[e])||d.push(e+": "+a(r[e]));e=[];e.push('<div class="mistvideo" id="'+c+'">');e.push("  <noscript>");e.push('    <a href="'+(otherhost.https?F.https:F.http)+L+'.html" target="_blank">');e.push("      Click here to play this video");e.push("    </a>");e.push("  </noscript>");e.push("  <script>");e.push("    var a = function(){");e.push('      mistPlay("'+b+'",{');e.push("        "+d.join(",\n        "));e.push("      });");
e.push("    };");e.push("    if (!window.mistplayers) {");e.push('      var p = document.createElement("script");');"https"in y&&"https://"!=parseURL(y.http).protocol?(e.push('      if (location.protocol == "https:") { p.src = "'+F.https+'player.js" } '),e.push('      else { p.src = "'+F.http+'player.js" } ')):e.push('      p.src = "'+S+'player.js"');e.push("      document.head.appendChild(p);");e.push("      p.onload = a;");e.push("    }");e.push("    else { a(); }");e.push("  \x3c/script>");e.push("</div>");
return e.join("\n")};""==b&&UI.navTo("Streams");ba="";-1==b.indexOf("+")&&(ba=$("<button>").addClass("settings").text("Settings").click(function(){UI.navto("Edit",b)}));c.html($("<div>").addClass("bigbuttons").append(ba).append($("<button>").text("Preview").addClass("preview").click(function(){UI.navto("Preview",b)})).append($("<button>").addClass("cancel").addClass("return").text("Return").click(function(){UI.navto("Streams")}))).append($("<h2>").text('Embed "'+b+'"'));var da=$("<span>");c.append(da);
var L=encodeURIComponent(b),R=parseURL(mist.user.host),aa=R.protocol,W=R.host,K=":8080",ea,ka={},y={http:aa+W+K+"/"};for(t in mist.data.config.protocols)if(v=mist.data.config.protocols[t],"HTTP"==v.connector||"HTTP.exe"==v.connector)v.pubaddr?("string"==typeof v.pubaddr?y.http=v.pubaddr.replace(/\/$/,"")+"/":v.pubaddr.length&&(y.http=v.pubaddr[0].replace(/\/$/,"")+"/"),ka.http=v.pubaddr):(K=v.port?":"+v.port:":8080",y.http=aa+W+K+"/");else if("HTTPS"==v.connector||"HTTPS.exe"==v.connector)v.pubaddr&&
v.pubaddr.length?("string"==typeof v.pubaddr?y.https=v.pubaddr.replace(/\/$/,"")+"/":v.pubaddr.length&&(y.https=v.pubaddr[0].replace(/\/$/,"")+"/"),ka.https=v.pubaddr):(ea=v.port?":"+v.port:":4433",y.https="https://"+W+ea+"/");var S=y.http,F={http:y.http};"https"in y&&(F.https=y.https);if(otherhost.host||otherhost.https)S=(otherhost.https&&ea?"https://":"http://")+(otherhost.host?otherhost.host:R.host)+(otherhost.https&&ea?ea:K)+"/",otherhost.host&&("http"in ka||(F.http=parseURL(F.http,{hostname:otherhost.host}).full),
"https"in F&&!("https"in ka)&&(F.https=parseURL(F.https,{hostname:otherhost.host}).full)),S=otherhost.https?F.https:F.http;var ca=!1,wa={forcePlayer:"",forceType:"",controls:!0,autoplay:!0,loop:!1,muted:!1,fillSpace:!1,poster:"",urlappend:"",setTracks:{}},r=$.extend({},wa),Va=UI.stored.getOpts();"embedoptions"in Va&&(r=$.extend(r,Va.embedoptions,!0),"object"!=typeof r.setTracks&&(r.setTracks={}));var la={};switch(r.controls){case "stock":la.controls="stock";break;case !0:la.controls=1;break;case !1:la.controls=
0}var xa=$("<span>").text("Loading.."),Wa=C(r),X=$("<div>").text("Loading..").css("display","flex").css("flex-flow","column nowrap"),Xa="";"https"in y&&(Xa=UI.buildUI([{label:"Use HTTPS",type:"checkbox",function:function(){$(this).getval()!=otherhost.https&&(otherhost.https=$(this).getval(),UI.navto("Embed",b))},value:otherhost.https}]).find("label"));da.append($("<span>").addClass("input_container").append($("<label>").addClass("UIelement").append($("<span>").addClass("label").text("Use a different host:")).append($("<span>").addClass("field_container").append($("<input>").attr("type",
"text").addClass("field").val(otherhost.host?otherhost.host:R.host)).append($("<span>").addClass("unit").append($("<button>").text("Apply").click(function(){otherhost.host=$(this).closest("label").find("input").val();UI.navto("Embed",b)}))))).append(Xa)).append(UI.buildUI([$("<h3>").text("Urls"),{label:"Stream info json",type:"str",value:S+"json_"+L+".js",readonly:!0,clipboard:!0,help:"Information about this stream as a json page."},{label:"Stream info script",type:"str",value:S+"info_"+L+".js",readonly:!0,
clipboard:!0,help:"This script loads information about this stream into a mistvideo javascript object."},{label:"HTML page",type:"str",value:S+L+".html",readonly:!0,qrcode:!0,clipboard:!0,help:"A basic html containing the embedded stream."},$("<h3>").text("Embed code"),{label:"Embed code",type:"textarea",value:Wa,rows:Wa.split("\n").length+3,readonly:!0,classes:["embed_code"],clipboard:!0,help:"Include this code on your webpage to embed the stream. The options below can be used to configure how your content is displayed."},
$("<h4>").text("Embed code options (optional)").css("margin-top",0),{type:"help",help:"Use these controls to customise what this embedded video will look like.<br>Not all players have all of these options."},{label:"Prioritize type",type:"select",select:[["","Automatic"]],pointer:{main:r,index:"prioritize_type"},classes:["prioritize_type"],function:function(){ca&&(r.prioritize_type=$(this).getval(),$(".embed_code").setval(C(r)))},help:"Try to use this source type first, but full back to something else if it is not available."},
{label:"Force type",type:"select",select:[["","Automatic"]],pointer:{main:r,index:"forceType"},classes:["forceType"],function:function(){ca&&(r.forceType=$(this).getval(),$(".embed_code").setval(C(r)))},help:"Only use this particular source."},{label:"Force player",type:"select",select:[["","Automatic"]],pointer:{main:r,index:"forcePlayer"},classes:["forcePlayer"],function:function(){ca&&(r.forcePlayer=$(this).getval(),$(".embed_code").setval(C(r)))},help:"Only use this particular player."},{label:"Controls",
type:"select",select:[["1","MistServer Controls"],["stock","Player controls"],["0","None"]],pointer:{main:la,index:"controls"},function:function(){r.controls=1==$(this).getval();switch($(this).getval()){case 0:r.controls=!1;break;case 1:r.controls=!0;break;case "stock":r.controls="stock"}$(".embed_code").setval(C(r))},help:"The type of controls that should be shown."},{label:"Autoplay",type:"checkbox",pointer:{main:r,index:"autoplay"},function:function(){r.autoplay=$(this).getval();$(".embed_code").setval(C(r))},
help:"Whether or not the video should play as the page is loaded."},{label:"Loop",type:"checkbox",pointer:{main:r,index:"loop"},function:function(){r.loop=$(this).getval();$(".embed_code").setval(C(r))},help:"If the video should restart when the end is reached."},{label:"Start muted",type:"checkbox",pointer:{main:r,index:"muted"},function:function(){r.muted=$(this).getval();$(".embed_code").setval(C(r))},help:"If the video should restart when the end is reached."},{label:"Fill available space",type:"checkbox",
pointer:{main:r,index:"fillSpace"},function:function(){r.fillSpace=$(this).getval();$(".embed_code").setval(C(r))},help:"The video will fit the available space in its container, even if the video stream has a smaller resolution."},{label:"Poster",type:"str",pointer:{main:r,index:"poster"},function:function(){r.poster=$(this).getval();$(".embed_code").setval(C(r))},help:"URL to an image that is displayed when the video is not playing."},{label:"Video URL addition",type:"str",pointer:{main:r,index:"urlappend"},
help:"The embed script will append this string to the video url, useful for sending through params.",classes:["embed_code_forceprotocol"],function:function(){r.urlappend=$(this).getval();$(".embed_code").setval(C(r))}},{label:"Preselect tracks",type:"DOMfield",DOMfield:X,help:"Pre-select these tracks."},{label:"Monitoring action",type:"select",select:[["","Ask the viewer what to do"],["nextCombo","Try the next source / player combination"]],pointer:{main:r,index:"monitor_action"},function:function(){r.monitor_action=
$(this).getval();$(".embed_code").setval(C(r))},help:"What the player should do when playback is poor."},$("<h3>").text("Protocol stream urls"),xa]));$.ajax({type:"GET",url:S+"json_"+L+".js",success:function(a){var b=[],c=da.find(".field.forceType"),d=da.find(".field.prioritize_type"),e;for(e in a.source){var f=a.source[e],g=UI.humanMime(f.type);b.push({label:g?g+" <span class=description>("+f.type+")</span>":UI.format.capital(f.type),type:"str",value:f.url,readonly:!0,qrcode:!0,clipboard:!0});g=
UI.humanMime(f.type);0==c.children('option[value="'+f.type+'"]').length&&(c.append($("<option>").text(g?g+" ("+f.type+")":UI.format.capital(f.type)).val(f.type)),d.append($("<option>").text(g?g+" ("+f.type+")":UI.format.capital(f.type)).val(f.type)))}c.val(r.forceType);d.val(r.prioritize_type);xa.html(UI.buildUI(b));X.html("");b={};for(e in a.meta.tracks)if(c=a.meta.tracks[e],"subtitle"==c.codec&&(c.type="subtitle"),"audio"==c.type||"video"==c.type||"subtitle"==c.type)c.type in b||(b[c.type]="subtitle"==
c.type?[]:[["","Autoselect "+c.type]]),b[c.type].push([c.trackid,UI.format.capital(c.type)+" track "+(b[c.type].length+("subtitle"==c.type?1:0))]);if(Object.keys(b).length){X.closest("label").show();a=["audio","video","subtitle"];for(var h in a)if(e=a[h],b[e]&&b[e].length){c=$("<select>").attr("data-type",e).css("flex-grow","1").change(function(){""==$(this).val()?delete r.setTracks[$(this).attr("data-type")]:r.setTracks[$(this).attr("data-type")]=$(this).val();$(".embed_code").setval(C(r))});X.append(c);
"subtitle"==e?b[e].unshift(["","No "+e]):b[e].push([-1,"No "+e]);for(var k in b[e])c.append($("<option>").val(b[e][k][0]).text(b[e][k][1]));e in r.setTracks&&(c.val(r.setTracks[e]),null==c.val()&&(c.val(""),delete r.setTracks[e],$(".embed_code").setval(C(r))))}}else X.closest("label").hide();ca=!0},error:function(){xa.html("Error while retrieving stream info.");X.closest("label").hide();r.setTracks={}}});var ma=document.createElement("script");ma.src=y.http+"player.js";document.head.appendChild(ma);
ma.onload=function(){var a=da.find(".field.forcePlayer"),b;for(b in mistplayers)a.append($("<option>").text(mistplayers[b].name).val(b));document.head.removeChild(this)};ma.onerror=function(){document.head.removeChild(this)};break;case "Push":document.title="Push: Livepeer Project Aqueduct";UI.elements.header_title.text("Push");var fa=$("<div>").addClass("push_screen").text("Loading..");c.append(fa);mist.send(function(a){function b(a){setTimeout(function(){mist.send(function(c){var d=!1;if("push_list"in
c&&c.push_list&&c.push_list.length){var d=!0,f;for(f in c.push_list)if(-1<a.indexOf(c.push_list[f][0])){d=!1;break}}else d=!0;if(d)for(f in a)e.find("tr[data-pushid="+a[f]+"]").remove();else b()},{push_list:1})},1E3)}function c(f,g){var h=$("<span>"),k=$("<span>");"Automatic"==g&&4<=f.length?(h.append($("<span>").text(f[2])),f[3]&&h.append($("<span>").text(", schedule on "+(new Date(1E3*f[3])).toLocaleString())),5<=f.length&&f[4]&&h.append($("<span>").text(", complete on "+(new Date(1E3*f[4])).toLocaleString()))):
4<=f.length&&f[2]!=f[3]?h.append($("<span>").text(f[2])).append($("<span>").html("&#187").addClass("unit").css("margin","0 0.5em")).append($("<span>").text(f[3])):h.append($("<span>").text(f[2]));var l=$("<td>").append($("<button>").text("Automatic"==g?"Remove":"Stop").click(function(){if(confirm("Are you sure you want to "+$(this).text().toLowerCase()+" this push?\n"+f[1]+" to "+f[2])){var a=$(this).closest("tr");a.html($("<td colspan=99>").html($("<span>").addClass("red").text("Automatic"==g?"Removing..":
"Stopping..")));if("Automatic"==g){var c=f.slice(1);mist.send(function(){a.remove()},{push_auto_remove:[c]})}else mist.send(function(a){b([f[0]])},{push_stop:[f[0]]})}}));if("Automatic"==g)l.prepend($("<button>").text("Edit").click(function(){UI.navto("Start Push","auto_"+($(this).closest("tr").index()-1))})),l.append($("<button>").text("Stop pushes").click(function(){if(confirm('Are you sure you want to stop all pushes matching \n"'+f[1]+" to "+f[2]+'"?'+(0!=d.wait?"\n\nRetrying is enabled. You'll probably want to set that to 0.":
""))){var c=$(this);c.text("Stopping pushes..");var g=[],h;for(h in a.push_list)f[1]==a.push_list[h][1]&&f[2]==a.push_list[h][2]&&(g.push(a.push_list[h][0]),e.find("tr[data-pushid="+a.push_list[h][0]+"]").html($("<td colspan=99>").html($("<span>").addClass("red").text("Stopping.."))));mist.send(function(){c.text("Stop pushes");b(g)},{push_stop:g,push_settings:{wait:0}})}}));else{if(6<=f.length){var m=f[5];k.append($("<div>").append("Active for: "+UI.format.duration(m.active_seconds))).append($("<div>").append("Data transfered: "+
UI.format.bytes(m.bytes))).append($("<div>").append("Media time transfered: "+UI.format.duration(.001*m.mediatime)));"pkt_retrans_count"in m&&k.append($("<div>").append("Packets retransmitted: "+UI.format.number(m.pkt_retrans_count||0)));"pkt_loss_count"in m&&k.append($("<div>").append("Packets lost: "+UI.format.number(m.pkt_loss_count||0)+" ("+UI.format.addUnit(UI.format.number(m.pkt_loss_perc||0),"%")+" over the last "+UI.format.addUnit(5,"s")+")"))}if(5<=f.length)for(var n in f[4])m=f[4][n],k.append($("<div>").append(UI.format.time(m[0])+
" ["+m[1]+"] "+m[2]))}return $("<tr>").css("vertical-align","top").attr("data-pushid",f[0]).append($("<td>").text(f[1])).append($("<td>").append(h.children())).append($("<td>").addClass("logs").append(k.children())).append(l)}fa.html(UI.buildUI([{type:"help",help:"You can push streams to files or other servers, allowing them to broadcast your stream as well."}]));var d=a.push_settings;d||(d={});var e=$("<table>").append($("<tr>").append($("<th>").text("Stream")).append($("<th>").text("Target")).append($("<th>")).append($("<th>"))),
f=e.clone();if("push_list"in a)for(var g in a.push_list)e.append(c(a.push_list[g],"Manual"));if("push_auto_list"in a)for(g in a.push_auto_list){var h=a.push_auto_list[g].slice();h.unshift(-1);f.append(c(h,"Automatic"))}fa.append($("<h3>").text("Pushes")).append($("<button>").text("Start a push").click(function(){UI.navto("Start Push")}));if(1==e.find("tr").length)fa.append($("<div>").text("No pushes are active.").addClass("text").css("margin-top","0.5em"));else{var f=[],h=[],k=$("<select>").css("margin-left",
"0.5em").append($("<option>").text("Any stream").val("")),l=$("<select>").css("margin-left","0.5em").append($("<option>").text("Any target").val(""));for(g in a.push_list)-1==f.indexOf(a.push_list[g][1])&&f.push(a.push_list[g][1]),-1==h.indexOf(a.push_list[g][2])&&h.push(a.push_list[g][2]);f.sort();h.sort();for(g in f)k.append($("<option>").text(f[g]));for(g in h)l.append($("<option>").text(h[g]));fa.append($("<button>").text("Stop all pushes").click(function(){var c=[],d;for(d in a.push_list)c.push(a.push_list[d][0]);
0!=c.length&&confirm("Are you sure you want to stop all pushes?")&&(mist.send(function(a){b(c)},{push_stop:c}),e.find("tr:not(:first-child)").html($("<td colspan=99>").append($("<span>").addClass("red").text("Stopping.."))),$(this).remove())})).append($("<label>").css("margin-left","1em").append($("<span>").text("Stop all pushes that match: ").css("font-size","0.9em")).append(k).append($("<span>").css("margin-left","0.5em").text("and").css("font-size","0.9em")).append(l).append($("<button>").css("margin-left",
"0.5em").text("Apply").click(function(){var c=k.val(),d=l.val();if(""==c&&""==d)return alert("Looks like you want to stop all pushes. Maybe you should use that button?");var f={},g;for(g in a.push_list)""!=c&&a.push_list[g][1]!=c||""!=d&&a.push_list[g][2]!=d||(f[a.push_list[g][0]]=a.push_list[g]);if(0==Object.keys(f).length)return alert("No matching pushes.");c="Are you sure you want to stop these pushes?\n\n";for(g in f)c+=f[g][1]+" to "+f[g][2]+"\n";if(confirm(c))for(g in f=Object.keys(f),mist.send(function(a){b(f)},
{push_stop:f}),f)e.find("tr[data-pushid="+f[g]+"]").html($("<td colspan=99>").html($("<span>").addClass("red").text("Stopping..")))}))).append(e)}UI.interval.set(function(){mist.send(function(a){var b=e.find("tr").first();e.empty();e.append(b);for(var d in a.push_list)e.append(c(a.push_list[d]))},{push_list:1})},5E3)},{push_settings:1,push_list:1,push_auto_list:1});break;case "Start Push":var na=function(a){var d=!1,e=b.split("_");b=e[0];2==e.length&&(d=e[1]);if(!1!==d&&"undefined"==typeof a)mist.send(function(a){na(a.push_auto_list[d])},
{push_auto_list:1});else{var f=[],g={},h;for(h in mist.data.capabilities.connectors)e=mist.data.capabilities.connectors[h],"push_urls"in e&&(f=f.concat(e.push_urls),g[h]=e.push_urls);"auto"==b&&c.find("h2").text("Add automatic push");var k={params:{}};if("auto"==b&&"undefined"!=typeof a&&(k={stream:a[0],target:a[1],params:{}},e=k.target.split("?"),1<e.length))for(h in params=e.pop(),k.target=e.join("?"),params=params.split("&"),params)e=params[h].split("="),k.params[e.shift()]=e.join("=");var l=$("<div>").css("margin",
"1em 0");h=[{label:"Stream name",type:"str",help:"This may either be a full stream name, a partial wildcard stream name, or a full wildcard stream name.<br>For example, given the stream <i>a</i> you can use:                    <ul>                      <li><i>a</i>: the stream configured as <i>a</i></li>                      <li><i>a+</i>: all streams configured as <i>a</i> with a wildcard behind it, but not <i>a</i> itself</li>                      <li><i>a+b</i>: only the version of stream <i>a</i> that has wildcard <i>b</i></li>                    </ul>",
pointer:{main:k,index:"stream"},validate:["required",function(a,b){var c=a.split("+"),c=c[0];return c in mist.data.streams?!1:{msg:"'"+c+"' is not a stream name.",classes:["orange"],break:!1}}],datalist:B,LTSonly:1},$("<div>").addClass("text margin").text("This may either be a full stream name, a partial wildcard stream name, or a full wildcard stream name. Examples."),{label:"Target",type:"str",help:"Where the stream will be pushed to.<br>                  Valid formats:                  <ul>                    <li>"+
f.join("</li><li>")+"</li>                  </ul>                  Valid text replacements:                  <ul>                    <li>$stream - inserts the stream name used to push to MistServer</li>                    <li>$day - inserts the current day number</li><li>$month - inserts the current month number</li>                    <li>$year - inserts the current year number</li><li>$hour - inserts the hour timestamp when stream was received</li>                    <li>$minute - inserts the minute timestamp the stream was received</li>                    <li>$seconds - inserts the seconds timestamp when the stream was received</li>                    <li>$datetime - inserts $year.$month.$day.$hour.$minute.$seconds timestamp when the stream was received</li>                  </ul>                  Valid URL parameters:                  <ul>                    <li>recstart=123 - media timestamp in milisseconds where the push should start</li>                    <li>recstop=456 - media timestamp in miliseconds where the push should stop</li>                    <li>recstartunix=150000000 - unix time in seconds where the push should start. This will override the recstart parameter.</li>                    <li>recstopunix=150000000 - unix time in seconds where the push should stop. This will override the recstop parameter.</li>                  </ul>",
pointer:{main:k,index:"target"},validate:["required",function(a,b){for(var c in f)if(mist.inputMatch(f[c],a))return!1;return{msg:"Does not match a valid target.<br>Valid formats:<ul><li>"+f.join("</li><li>")+"</li></ul>",classes:["red"]}}],function:function(){var a=!1;for(connector in g)for(var b in g[connector])if(mist.inputMatch(g[connector][b],$(this).getval())){a=connector;break}a?(l.html($("<h3>").text(mist.data.capabilities.connectors[a].friendly)),l.append(UI.buildUI(mist.convertBuildOptions({desc:mist.data.capabilities.connectors[a].desc,
optional:mist.data.capabilities.connectors[a].push_parameters},k.params)))):l.html($("<h4>").addClass("red").text("Unrecognized target.")).append($("<span>").text("Please edit the push target."))},LTSonly:1},$("<div>").addClass("text").text("Where the stream will be pushed to."),$("<div>").addClass("text").text("Valid formats | Valid Text replacements | Valid URL parameters"),l];h.push({type:"buttons",buttons:[{type:"cancel",label:"Cancel",function:function(){UI.navto("Push")}},{type:"save",label:"Save",
function:function(){var c=k.params,d;for(d in c)null===c[d]&&delete c[d];if(Object.keys(c).length){var e="?",f=k.target.split("?");if(1<f.length)for(d in e="&",f=f[f.length-1],f=f.split("&"),f){var g=f[d].split("=")[0];g in c&&delete c[g]}if(Object.keys(c).length){f=[];for(d in c)f.push(d+"="+c[d]);e+=f.join("&");k.target+=e}}c={};c["auto"==b?"push_auto_add":"push_start"]=k;"undefined"==typeof a||a[0]==k.stream&&a[1]==k.target||(c.push_auto_remove=[a]);mist.send(function(){UI.navto("Push")},c)}}]});
c.append($("<span>").addClass("description").text("Some explainer text could go here"));c.append($("<div>").addClass("start_push_box").append(UI.buildUI(h)))}};document.title="Start Push: Livepeer Project Aqueduct";UI.elements.header_title.text("Start Push");if(!("capabilities"in mist.data)){c.append("Loading Mist capabilities..");mist.send(function(){UI.navto("Start Push",b)},{capabilities:1});return}var B;mist.data.LTS?mist.send(function(a){(B=a.active_streams)||(B=[]);a=[];for(var b in B)-1!=B[b].indexOf("+")&&
a.push(B[b].replace(/\+.*/,"")+"+");B=B.concat(a);var c=0,d=0;for(b in mist.data.streams)B.push(b),mist.inputMatch(UI.findInput("Folder").source_match,mist.data.streams[b].source)&&(B.push(b+"+"),mist.send(function(a,b){var e=b.stream,f;for(f in a.browse.files)for(var g in mist.data.capabilities.inputs)0<=g.indexOf("Buffer")||0<=g.indexOf("Folder")||0<=g.indexOf("Buffer.exe")||0<=g.indexOf("Folder.exe")||mist.inputMatch(mist.data.capabilities.inputs[g].source_match,"/"+a.browse.files[f])&&B.push(e+
"+"+a.browse.files[f]);d++;c==d&&(B=B.filter(function(a,b,c){return c.lastIndexOf(a)===b}).sort(),na())},{browse:mist.data.streams[b].source},{stream:b}),c++);c==d&&(B=B.filter(function(a,b,c){return c.lastIndexOf(a)===b}).sort(),na())},{active_streams:1}):(B=Object.keys(mist.data.streams),na());break;case "Triggers":"triggers"in mist.data.config&&mist.data.config.triggers||(mist.data.config.triggers={});var G=$("<tbody>"),Ya=$("<table>").html($("<thead>").html($("<tr>").html($("<th>").text("Trigger on").attr("data-sort-type",
"string").addClass("sorting-asc")).append($("<th>").text("Applies to").attr("data-sort-type","string")).append($("<th>").text("Handler").attr("data-sort-type","string")).append($("<th>")))).append(G);c.append(UI.buildUI([{type:"help",help:"Triggers are a way to react to events that occur inside MistServer. These allow you to block specific users, redirect streams, keep tabs on what is being pushed where, etcetera. For full documentation, please refer to the developer documentation section on the MistServer website."}])).append($("<button>").text("New trigger").click(function(){UI.navto("Edit Trigger")})).append(Ya);
Ya.stupidtable();var ya=mist.data.config.triggers;for(t in ya)for(var Za in ya[t]){var za=triggerRewrite(ya[t][Za]);G.append($("<tr>").attr("data-index",t+","+Za).append($("<td>").text(t)).append($("<td>").text("streams"in za?za.streams.join(", "):"")).append($("<td>").text(za.handler)).append($("<td>").html($("<button>").text("Edit").click(function(){UI.navto("Edit Trigger",$(this).closest("tr").attr("data-index"))})).append($("<button>").text("Delete").click(function(){var a=$(this).closest("tr").attr("data-index").split(",");
confirm("Are you sure you want to delete this "+a[0]+" trigger?")&&(mist.data.config.triggers[a[0]].splice(a[1],1),0==mist.data.config.triggers[a[0]].length&&delete mist.data.config.triggers[a[0]],mist.send(function(a){UI.navto("Triggers")},{config:mist.data.config}))}))))}break;case "Edit Trigger":"triggers"in mist.data.config&&mist.data.config.triggers||(mist.data.config.triggers={});if("undefined"==typeof mist.data.capabilities){mist.send(function(b){UI.navto(a)},{capabilities:!0});c.append("Loading..");
return}if(b){b=b.split(",");var ga=triggerRewrite(mist.data.config.triggers[b[0]][b[1]]),q={triggeron:b[0],appliesto:ga.streams,url:ga.handler,async:ga.sync,default:ga["default"],params:ga.params}}else c.html($("<h2>").text("New Trigger")),q={};var $a=[];for(t in mist.data.capabilities.triggers)$a.push([t,t+": "+mist.data.capabilities.triggers[t].when]);var Aa=$("<div>").addClass("desc"),ab=$("<div>");c.append(UI.buildUI([{label:"Trigger on",pointer:{main:q,index:"triggeron"},help:"For what event this trigger should activate.",
type:"select",select:$a,LTSonly:!0,validate:["required"],function:function(){var a=$(this).getval(),b=mist.data.capabilities.triggers[a];Aa.html("");b&&(a=[$("<h4>").text("Trigger properties"),{type:"help",help:'The trigger "<i>'+a+'</i>" has the following properties:'},{type:"span",label:"Triggers",value:b.when,help:"When this trigger is activated"}],""!=b.payload&&a.push({label:"Payload",type:"textarea",value:b.payload,rows:b.payload.split("\n").length,readonly:!0,clipboard:!0,help:"The information this trigger sends to the handler."}),
a.push({type:"span",label:"Requires response",value:function(a){switch(a){case "ignored":return"No. The trigger will ignore the response of the handler.";case "always":return"Yes. The trigger needs a response to proceed.";case "when-blocking":return"The trigger needs a response to proceed if it is configured to be blocking.";default:return a}}(b.response),help:"Whether this trigger requires a response from the trigger handler"}),a.push({type:"span",label:"Response action",value:b.response_action,
help:"What this trigger will do with its handler's response"}),Aa.append(UI.buildUI(a)),b.stream_specific?$("[name=appliesto]").closest(".UIelement").show():$("[name=appliesto]").setval([]).closest(".UIelement").hide(),b.argument?($("[name=params]").closest(".UIelement").show(),ab.text(b.argument)):$("[name=params]").setval("").closest(".UIelement").hide())}},Aa,$("<h4>").text("Trigger settings"),{label:"Applies to",pointer:{main:q,index:"appliesto"},help:"For triggers that can apply to specific streams, this value decides what streams they are triggered for. (none checked = always triggered)",
type:"checklist",checklist:Object.keys(mist.data.streams),LTSonly:!0},$("<br>"),{label:"Handler (URL or executable)",help:"This can be either an HTTP URL or a full path to an executable.",pointer:{main:q,index:"url"},validate:["required"],type:"str",LTSonly:!0},{label:"Blocking",type:"checkbox",help:"If checked, pauses processing and uses the response of the handler. If the response does not start with 1, true, yes or cont, further processing is aborted. If unchecked, processing is never paused and the response is not checked.",
pointer:{main:q,index:"async"},LTSonly:!0},{label:"Parameters",type:"str",help:$("<div>").text("The extra data you want this trigger to use.").append(ab),pointer:{main:q,index:"params"},LTSonly:!0},{label:"Default response",type:"str",help:"The default response in case the handler fails or is set to non-blocking.",placeholder:"true",pointer:{main:q,index:"default"},LTSonly:!0},{type:"buttons",buttons:[{type:"cancel",label:"Cancel",function:function(){UI.navto("Triggers")}},{type:"save",label:"Save",
function:function(){b&&mist.data.config.triggers[b[0]].splice(b[1],1);var a={handler:q.url,sync:q.async?!0:!1,streams:"undefined"==typeof q.appliesto?[]:q.appliesto,params:q.params,default:q["default"]};"triggers"in mist.data.config||(mist.data.config.triggers={});q.triggeron in mist.data.config.triggers||(mist.data.config.triggers[q.triggeron]=[]);mist.data.config.triggers[q.triggeron].push(a);mist.send(function(){UI.navto("Triggers")},{config:mist.data.config})}}]}]));$("[name=triggeron]").trigger("change");
break;case "Logs":var Ba=function(){var a=mist.data.log;if(a){2<=a.length&&a[0][0]<a[a.length-1][0]&&a.reverse();G.html("");for(var b in a){var c=$("<span>").addClass("content"),d=a[b][2].split("|"),e;for(e in d)c.append($("<span>").text(d[e]));G.append($("<tr>").html($("<td>").text(UI.format.dateTime(a[b][0],"long")).css("white-space","nowrap")).append($("<td>").html(ib(a[b][1])).css("text-align","center")).append($("<td>").html(c).css("text-align","left")))}}},ib=function(a){var b=$("<span>").text(a);
switch(a){case "WARN":b.addClass("orange");break;case "ERROR":case "FAIL":b.addClass("red")}return b},bb=$("<button>").text("Refresh now").click(function(){$(this).text("Loading..");mist.send(function(){Ba();bb.text("Refresh now")})}).css("padding","0.2em 0.5em").css("flex-grow",0);c.append(UI.buildUI([{type:"help",help:"Here you have an overview of all edited settings within MistServer and possible warnings or errors MistServer has encountered. MistServer stores up to 100 logs at a time."},{label:"Refresh every",
type:"select",select:[[10,"10 seconds"],[30,"30 seconds"],[60,"minute"],[300,"5 minutes"]],value:30,function:function(){UI.interval.clear();UI.interval.set(function(){mist.send(function(){Ba()})},1E3*$(this).val())},help:"How often the table below should be updated."},{label:"..or",type:"DOMfield",DOMfield:bb,help:"Instantly refresh the table below."}]));c.append($("<button>").text("Purge logs").click(function(){mist.send(function(){mist.data.log=[];UI.navto("Logs")},{clearstatlogs:!0})}));G=$("<tbody>").css("font-size",
"0.9em");c.append($("<table>").addClass("logs").append(G));Ba();break;case "Statistics":var H=$("<span>").text("Loading..");c.append(H);var q={graph:"new"},D=mist.stored.get().graphs?$.extend(!0,{},mist.stored.get().graphs):{},ha={};for(t in mist.data.streams)ha[t]=!0;for(t in mist.data.active_streams)ha[mist.data.active_streams[t]]=!0;var ha=Object.keys(ha).sort(),Ca=[];for(t in mist.data.config.protocols)Ca.push(mist.data.config.protocols[t].connector);Ca.sort();mist.send(function(){UI.plot.datatype.templates.cpuload.cores=
0;for(var a in mist.data.capabilities.cpu)UI.plot.datatype.templates.cpuload.cores+=mist.data.capabilities.cpu[a].cores;H.html(UI.buildUI([{type:"help",help:"Here you will find the MistServer stream statistics, you can select various categories yourself. All statistics are live: up to five minutes are saved."},$("<h3>").text("Select the data to display"),{label:"Add to",type:"select",select:[["new","New graph"]],pointer:{main:q,index:"graph"},classes:["graph_ids"],function:function(){if($(this).val()){var a=
H.find(".graph_xaxis"),b=H.find(".graph_id");if("new"==$(this).val())a.children("option").prop("disabled",!1),b.setval("Graph "+(Object.keys(D).length+1)).closest("label").show();else{var c=D[$(this).val()].xaxis;a.children("option").prop("disabled",!0).filter('[value="'+c+'"]').prop("disabled",!1);b.closest("label").hide()}a.children('option[value="'+a.val()+'"]:disabled').length&&a.val(a.children("option:enabled").first().val());a.trigger("change")}}},{label:"Graph id",type:"str",pointer:{main:q,
index:"id"},classes:["graph_id"],validate:[function(a,b){return a in D?{msg:"This graph id has already been used. Please enter something else.",classes:["red"]}:!1}]},{label:"Axis type",type:"select",select:[["time","Time line"]],pointer:{main:q,index:"xaxis"},value:"time",classes:["graph_xaxis"],function:function(){$s=H.find(".graph_datatype");switch($(this).getval()){case "coords":$s.children("option").prop("disabled",!0).filter('[value="coords"]').prop("disabled",!1);break;case "time":$s.children("option").prop("disabled",
!1).filter('[value="coords"]').prop("disabled",!0)}if(!$s.val()||$s.children('option[value="'+$s.val()+'"]:disabled').length)$s.val($s.children("option:enabled").first().val()),$s.trigger("change")}},{label:"Data type",type:"select",select:[["clients","Connections"],["upbps","Bandwidth (up)"],["downbps","Bandwidth (down)"],["cpuload","CPU use"],["memload","Memory load"],["coords","Client location"],["perc_lost","Lost packages"],["perc_retrans","Re-transmitted packages"]],pointer:{main:q,index:"datatype"},
classes:["graph_datatype"],function:function(){$s=H.find(".graph_origin");switch($(this).getval()){case "cpuload":case "memload":$s.find("input[type=radio]").not('[value="total"]').prop("disabled",!0);$s.find('input[type=radio][value="total"]').prop("checked",!0);break;default:$s.find("input[type=radio]").prop("disabled",!1)}}},{label:"Data origin",type:"radioselect",radioselect:[["total","All"],["stream","The stream:",ha],["protocol","The protocol:",Ca]],pointer:{main:q,index:"origin"},value:["total"],
classes:["graph_origin"]},{type:"buttons",buttons:[{label:"Add data set",type:"save",function:function(){var a;"new"==q.graph?(a=UI.plot.addGraph(q,b),D[a.id]=a,H.find("input.graph_id").val(""),H.find("select.graph_ids").append($("<option>").text(a.id)).val(a.id).trigger("change")):a=D[q.graph];var c=UI.plot.datatype.getOptions({datatype:q.datatype,origin:q.origin});a.datasets.push(c);UI.plot.save(a);UI.plot.go(D)}}]}]));var b=$("<div>").addClass("graph_container");c.append(b);var d=H.find("select.graph_ids");
for(a in D){var e=UI.plot.addGraph(D[a],b);d.append($("<option>").text(e.id)).val(e.id);var f=[],g;for(g in D[a].datasets){var h=UI.plot.datatype.getOptions({datatype:D[a].datasets[g].datatype,origin:D[a].datasets[g].origin});f.push(h)}e.datasets=f;D[e.id]=e}d.trigger("change");UI.plot.go(D);UI.interval.set(function(){UI.plot.go(D)},1E4)},{active_streams:!0,capabilities:!0});break;case "Server Stats":var cb=function(){var a=mist.data.capabilities.mem,b=mist.data.capabilities.load,a={vheader:"Memory",
labels:["Used","Cached","Available","Total"],content:[{header:"Physical memory",body:[UI.format.bytes(1048576*a.used)+" ("+UI.format.addUnit(b.memory,"%")+")",UI.format.bytes(1048576*a.cached),UI.format.bytes(1048576*a.free),UI.format.bytes(1048576*a.total)]},{header:"Swap memory",body:[UI.format.bytes(1048576*(a.swaptotal-a.swapfree)),UI.format.addUnit("","N/A"),UI.format.bytes(1048576*a.swapfree),UI.format.bytes(1048576*a.swaptotal)]}]},a=UI.buildVheaderTable(a);Da.replaceWith(a);Da=a;b={vheader:"Load average",
labels:["CPU use","1 minute","5 minutes","15 minutes"],content:[{header:"&nbsp;",body:[UI.format.addUnit(UI.format.number(mist.data.capabilities.cpu_use/10),"%"),UI.format.number(b.one/100),UI.format.number(b.five/100),UI.format.number(b.fifteen/100)]}]};b=UI.buildVheaderTable(b);O.replaceWith(b);O=b};if("undefined"==typeof mist.data.capabilities){mist.send(function(b){UI.navto(a)},{capabilities:!0});c.append("Loading..");return}var Da=$("<table>"),O=$("<table>"),db={vheader:"CPUs",labels:["Model",
"Processor speed","Amount of cores","Amount of threads"],content:[]};for(t in mist.data.capabilities.cpu){var oa=mist.data.capabilities.cpu[t];db.content.push({header:"CPU #"+(Number(t)+1),body:[oa.model,UI.format.addUnit(UI.format.number(oa.mhz),"MHz"),oa.cores,oa.threads]})}var jb=UI.buildVheaderTable(db);cb();c.append(UI.buildUI([{type:"help",help:"You can find general server statistics here. Note that memory and CPU usage is for your entire machine, not just MistServer."}])).append($("<table>").css("width",
"auto").addClass("nolay").append($("<tr>").append($("<td>").append(Da)).append($("<td>").append(O))).append($("<tr>").append($("<td>").append(jb).attr("colspan",2))));UI.interval.set(function(){mist.send(function(){cb()},{capabilities:!0})},3E4);break;case "Email for Help":var I=$.extend({},mist.data);delete I.statistics;delete I.totals;delete I.clients;delete I.capabilities;I=JSON.stringify(I);I="Version: "+mist.data.config.version+"\n\nConfig:\n"+I;q={};c.append(UI.buildUI([{type:"help",help:"You can use this form to email MistServer support if you're having difficulties.<br>A copy of your server config file will automatically be included."},
{type:"str",label:"Your name",validate:["required"],pointer:{main:q,index:"name"},value:mist.user.name},{type:"email",label:"Your email address",validate:["required"],pointer:{main:q,index:"email"}},{type:"hidden",value:"Integrated Help",pointer:{main:q,index:"subject"}},{type:"hidden",value:"-",pointer:{main:q,index:"company"}},{type:"textarea",rows:20,label:"Your message",validate:["required"],pointer:{main:q,index:"message"}},{type:"textarea",rows:20,label:"Your config file",readonly:!0,value:I,
pointer:{main:q,index:"configfile"}},{type:"buttons",buttons:[{type:"save",label:"Send",function:function(a){$(a).text("Sending..");$.ajax({type:"POST",url:"https://mistserver.org/contact?skin=plain",data:q,success:function(a){a=$("<span>").html(a);a.find("script").remove();c.html(a[0].innerHTML)}})}}]}]));break;case "Disconnect":mist.user.password="";delete mist.user.authstring;delete mist.user.loggedin;sessionStorage.removeItem("mistLogin");UI.navto("Login");break;default:c.append($("<p>").text("This tab does not exist."))}c.find(".field").filter(function(){var a=
$(this).getval();return""==a||null==a?!0:!1}).each(function(){var a=[];$(this).is("input, select, textarea")?a.push($(this)):a=$(this).find("input, select, textarea");if(a.length)return $(a[0]).focus(),!1})}};"origin"in location||(location.origin=location.protocol+"//");var host;host="file://"==location.origin?"http://localhost:4242/api":location.origin+location.pathname.replace(/\/+$/,"")+"/api";
var mist={data:{},user:{name:"",password:"",host:host},send:function(a,b,c){b=b||{};c=c||{};c=$.extend(!0,{timeOut:3E4,sendData:b},c);var d={authorize:{password:mist.user.authstring?MD5(mist.user.password+mist.user.authstring):"",username:mist.user.name}};$.extend(!0,d,b);log("Send",$.extend(!0,{},b));var e={url:mist.user.host,type:"POST",data:{command:JSON.stringify(d)},dataType:"jsonp",crossDomain:!0,timeout:1E3*c.timeout,async:!0,error:function(d,e,h){console.warn("connection failed :(",h);delete mist.user.loggedin;
if(!c.hide){switch(e){case "timeout":e=$("<i>").text("The connection timed out. ");break;case "abort":e=$("<i>").text("The connection was aborted. ");break;default:e=$("<i>").text(e+". ").css("text-transform","capitalize")}$("#message").addClass("red").text("An error occurred while attempting to communicate with MistServer:").append($("<br>")).append($("<span>").text(e)).append($("<a>").text("Send server request again").click(function(){mist.send(a,b,c)}))}UI.navto("Login")},success:function(e){log("Receive",
$.extend(!0,{},e),"as reply to",c.sendData);delete mist.user.loggedin;switch(e.authorize.status){case "OK":"streams"in e&&(e.streams?"incomplete list"in e.streams?(delete e.streams["incomplete list"],$.extend(mist.data.streams,e.streams)):mist.data.streams=e.streams:mist.data.streams={});var p=$.extend({},e),h="config capabilities ui_settings LTS active_streams browse log totals bandwidth".split(" "),u;for(u in p)-1==h.indexOf(u)&&delete p[u];"bandwidth"in d&&!("bandwidth"in e)&&(p.bandwidth=null);
$.extend(mist.data,p);mist.user.loggedin=!0;e.LTS&&UI.elements.menu.find(".LTSonly").removeClass("LTSonly");if("totals"in e){var p=function(a,b,c){c=w(c);stream=a?a.join(" "):"all_streams";protocol=b?b.join("_"):"all_protocols";stream in mist.data.totals||(mist.data.totals[stream]={});protocol in mist.data.totals[stream]||(mist.data.totals[stream][protocol]={});$.extend(mist.data.totals[stream][protocol],c)},w=function(a){function b(d){for(var e in a.fields)c[a.fields[e]].push([h,0])}var c={},d;for(d in a.fields)c[a.fields[d]]=
[];var e=0,h;if(a.data){a.start>mist.data.config.time-600?(h=1E3*(mist.data.config.time-600),b(),h=1E3*a.start,b()):h=1E3*a.start;for(d in a.data){if(0==d){h=1E3*a.start;var n=0}else h+=1E3*a.interval[n][1],a.interval[n][0]--,0>=a.interval[n][0]&&(n++,n<a.interval.length-1&&(e+=2));1==e%2&&(b(),e--);for(var p in a.data[d])c[a.fields[p]].push([h,a.data[d][p]]);e&&(b(),e--)}20<mist.data.config.time-a.end&&(b(),h=1E3*(mist.data.config.time-15),b())}else h=1E3*(mist.data.config.time-600),b(),h=1E3*(mist.data.config.time-
15),b();return c};mist.data.totals={};if("fields"in e.totals)p(b.totals.streams,b.totals.protocols,e.totals);else for(u in e.totals)p(b.totals[u].streams,b.totals[u].protocols,e.totals[u])}a&&a(e,c);break;case "CHALL":e.authorize.challenge==mist.user.authstring?UI.navto("Login"):""==mist.user.password?UI.navto("Login"):(mist.user.authstring=e.authorize.challenge,mist.send(a,b,c),sessionStorage.setItem("mistLogin",JSON.stringify({host:mist.user.host,name:mist.user.name,password:mist.user.password})));
break;case "NOACC":UI.navto("Create a new account");break;case "ACC_MADE":delete b.authorize;mist.send(a,b,c);break;default:UI.navto("Login")}}};$.ajax(e)},inputMatch:function(a,b){if("undefined"==typeof a)return!1;"string"==typeof a&&(a=[a]);for(var c in a){var d=a[c].replace(/[^\w\s]/g,"\\$&"),d=d.replace(/\\\*/g,".*");if((new RegExp("^(?:[a-zA-Z]:)?"+d+"(?:\\?[^\\?]*)?$","i")).test(b))return!0}return!1},convertBuildOptions:function(a,b){function c(a,c,d){var f={label:UI.format.capital(d.name?d.name:
c),pointer:{main:b,index:c},validate:[]};"required"!=e[a]||"default"in d&&""!=d["default"]||f.validate.push("required");if("default"in d&&(f.placeholder=d["default"],"select"==d.type))for(var h in d.select)if(d.select[h][0]==d["default"]){f.placeholder=d.select[h][1];break}"help"in d&&(f.help=d.help);"unit"in d&&(f.unit=d.unit);"placeholder"in d&&(f.placeholder=d.placeholder);if("type"in d)switch(d.type){case "int":f.type="int";"max"in d&&(f.max=d.max);"min"in d&&(f.min=d.min);break;case "uint":f.type=
"int";f.min=0;"max"in d&&(f.max=d.max);"min"in d&&(f.min=Math.max(f.min,d.min));break;case "json":case "debug":case "inputlist":f.type=d.type;break;case "radioselect":f.type="radioselect";f.radioselect=d.radioselect;break;case "select":f.type="select";f.select=d.select.slice(0);0<=f.validate.indexOf("required")&&f.select.unshift(["","placeholder"in f?"Default ("+f.placeholder+")":""]);break;case "sublist":f.type="sublist";f.saveas={};f.itemLabel=d.itemLabel;f.sublist=mist.convertBuildOptions(d,f.saveas);
break;default:f.type="str"}else f.type="checkbox";"influences"in d&&(f["function"]=function(){var a=$(this).closest(".UIelement"),b=a.find("style");b.length?b=b[0]:(b=$("<style>").addClass("dependencies")[0],a.append(b));b.innerHTML=".UIelement[data-dependent-"+c+"]:not([data-dependent-"+c+'~="'+$(this).getval()+'"]) { display: none; }\n';$(b).data("content",b.innerHTML);$("style.dependencies.hidden").each(function(){$(this).html($(this).data("content")).removeClass("hidden")});$(".UIelement:not(:visible) style.dependencies:not(.hidden)").each(function(){$(this).addClass("hidden");
$(this).html("")})});"dependent"in d&&(f.dependent=d.dependent);"value"in d&&(f.value=d.value);"validate"in d&&(f.validate=f.validate.concat(d.validate));return f}var d=[],e=["required","optional"];"desc"in a&&d.push({type:"help",help:a.desc});for(var n in e)if(a[e[n]]){d.push($("<h4>").text(UI.format.capital(e[n])+" parameters"));var p=Object.keys(a[e[n]]);"sort"in a&&p.sort(function(b,c){return(""+a[e[n]][b][a.sort]).localeCompare(a[e[n]][c][a.sort])});for(var h in p){var u=p[h],w=a[e[n]][u];if(Array.isArray(w))for(var k in w)d.push(c(n,
u,w[k]));else d.push(c(n,u,w))}}return d},stored:{get:function(){return mist.data.ui_settings||{}},set:function(a,b){var c=this.get();c[a]=b;mist.send(function(){},{ui_settings:c})},del:function(a){delete mist.data.ui_settings[a];mist.send(function(){},{ui_settings:mist.data.ui_settings})}}};function log(){try{UI.debug&&[].push.call(arguments,Error().stack),[].unshift.call(arguments,"["+UI.format.time((new Date).getTime()/1E3)+"]"),console.log.apply(console,arguments)}catch(a){}}
$.fn.getval=function(){var a=$(this).data("opts"),b=$(this).val();if(a&&"type"in a)switch(a.type){case "int":""!=b&&(b=Number(b));break;case "span":b=$(this).html();break;case "debug":b=""==$(this).val()?null:Number($(this).val());break;case "checkbox":b=$(this).prop("checked");break;case "radioselect":a=$(this).find("label > input[type=radio]:checked").parent();a.length?(b=[],b.push(a.children("input[type=radio]").val()),a=a.children("select"),a.length&&b.push(a.val())):b="";break;case "checklist":b=
[];$(this).find(".checklist input[type=checkbox]:checked").each(function(){b.push($(this).attr("name"))});break;case "unix":""!=b&&(b=Math.round(new Date($(this).val())/1E3));break;case "selectinput":b=$(this).children("select").first().val();"CUSTOM"==b&&(b=$(this).children("label").first().find(".field_container").children().first().getval());break;case "inputlist":b=[];$(this).children().each(function(){""!=$(this).val()&&b.push($(this).val())});break;case "sublist":b=$(this).data("savelist");
break;case "json":try{b=JSON.parse($(this).val())}catch(c){b=null}}return b};
$.fn.setval=function(a){var b=$(this).data("opts");$(this).val(a);if(b&&"type"in b)switch(b.type){case "span":$(this).html(a);break;case "checkbox":$(this).prop("checked",a);break;case "geolimited":case "hostlimited":b=$(this).closest(".field_container").data("subUI");if("undefined"==typeof a||0==a.length)a="-";b.blackwhite.val(a.charAt(0));a=a.substr(1).split(" ");for(var c in a)b.values.append(b.prototype.clone(!0).val(a[c]));b.blackwhite.trigger("change");break;case "radioselect":if("undefined"==
typeof a)return $(this);c=$(this).find('label > input[type=radio][value="'+a[0]+'"]').prop("checked",!0).parent();1<a.length&&c.children("select").val(a[1]);break;case "checklist":b=$(this).find(".checklist input[type=checkbox]").prop("checked",!1);for(c in a)b.filter('[name="'+a[c]+'"]').prop("checked",!0);break;case "unix":"undefined"!=typeof a&&(a=new Date(1E3*Math.round(a)),a.setMinutes(a.getMinutes()-a.getTimezoneOffset()),a=a.toISOString(),$(this).val(a.split("Z")[0]));break;case "selectinput":null===
a&&(a="");var d=!1;for(c in b.selectinput){var e;"string"==typeof b.selectinput[c]?e=b.selectinput[c]:"string"==typeof b.selectinput[c][0]&&(e=b.selectinput[c][0]);if(e==a){$(this).children("select").first().val(a);d=!0;break}}d||($(this).children("label").first().find(".field_container").children().first().setval(a),$(this).children("select").first().val("CUSTOM").trigger("change"));break;case "inputlist":"string"==typeof a&&(a=[a]);for(c in a)$(this).append($(this).data("newitem")().val(a[c]));
$(this).append($(this).children().first());break;case "sublist":var n=$(this),b=$(this).children(".curvals");b.html("");if(a&&a.length)for(c in a){var p=function(a){for(var b in a)"x-LSP-"==b.slice(0,6)?delete a[b]:"object"==typeof a[b]&&p(a[b])},d=$.extend(!0,{},a[c]);p(d);b.append($("<div>").addClass("subitem").append($("<span>").addClass("itemdetails").text(a[c]["x-LSP-name"]?a[c]["x-LSP-name"]:JSON.stringify(d)).attr("title",JSON.stringify(d,null,2))).append($("<button>").addClass("move").text("^").attr("title",
"Move item up").click(function(){var a=$(this).parent().index();if(0!=a){var b=n.getval();b.splice(a-1,0,b.splice(a,1)[0]);n.setval(b)}})).append($("<button>").text("Edit").click(function(){var a=$(this).parent().index(),b=$(this).closest(".field");b.data("build")(Object.assign({},b.getval()[a]),a)})).append($("<button>").text("x").attr("title","Remove item").click(function(a){var b=$(this).parent().index(),c=n.data("savelist");c.splice(b,1);n.setval(c);a.preventDefault()})))}else b.append("None.");
n.data("savelist",a);break;case "json":$(this).val(null===a?"":JSON.stringify(a,null,2))}$(this).trigger("change");return $(this)};function parseURL(a,b){var c=document.createElement("a");c.href=a;if(b)for(var d in b)c[d]=b[d];return{full:c.href,protocol:c.protocol+"//",host:c.hostname,port:c.port?":"+c.port:""}}function triggerRewrite(a){return"object"==typeof a&&"undefined"==typeof a.length?a:obj={handler:a[0],sync:a[1],streams:a[2],default:a[3]}};
